
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>clustertools.observations.observations &#8212; clustertools 0.1.dev1 documentation</title>
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">clustertools 0.1.dev1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for clustertools.observations.observations</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot; Routines for analysing Nbody models as if they were Observations</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Jeremy J Webb&quot;</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;obs_mass_function&quot;</span><span class="p">,</span>
    <span class="s2">&quot;obs_alpha_prof&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dx_corr_function&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">..analysis.operations</span> <span class="kn">import</span> <span class="n">save_cluster</span><span class="p">,</span> <span class="n">return_cluster</span>
<span class="kn">from</span> <span class="nn">..util.recipes</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">..util.plots</span> <span class="kn">import</span> <span class="o">*</span>


<div class="viewcode-block" id="obs_mass_function"><a class="viewcode-back" href="../../../reference/clustertools.observations.observations.html#clustertools.observations.observations.obs_mass_function">[docs]</a><span class="k">def</span> <span class="nf">obs_mass_function</span><span class="p">(</span>
    <span class="n">cluster</span><span class="p">,</span>
    <span class="n">mmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nmass</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">rmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">emin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">emax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">kwmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">kwmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">indx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mcorr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">projected</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">omask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       obs_mass_function</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Find mass function over a given mass range using nmass bins containing an equal number of stars.</span>
<span class="sd">       obs_mass_function differs from mass_function as it incorporates a mass completeness correction term and returns the completeness correction per bin</span>

<span class="sd">    INPUT:</span>

<span class="sd">       cluster - StarCluster instance</span>
<span class="sd">       mmin/mmax - specific mass range</span>
<span class="sd">       nmass - number of mass bins used to calculate alpha</span>
<span class="sd">       rmin/rmax - specific radial range</span>
<span class="sd">       vmin/vmax - specific velocity range</span>
<span class="sd">       emin/emax - specific energy range</span>
<span class="sd">       kwmin/kwmax - specific stellar evolution type range</span>
<span class="sd">       indx - specific subset of stars</span>
<span class="sd">       mcorr - correction for masses</span>
<span class="sd">       projected - use projected values</span>
<span class="sd">       omask - place a mask over the dataset and (WIP)</span>
<span class="sd">       plot - plot the mass function</span>
<span class="sd">       **kwargs - key words for plotting</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       m_mean,m_hist,dm,alpha,ealpha,yalpha,eyalpha</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">mcorr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">omask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">mcorr</span> <span class="o">=</span> <span class="n">omask</span><span class="o">.</span><span class="n">mcorr</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">mcorr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ntot</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mcorr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ntot</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">projected</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rpro</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vpro</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">r</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">v</span>

    <span class="k">if</span> <span class="n">rmin</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rmax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vmin</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vmax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mmin</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mmax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwmin</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kwmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwmax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kwmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">indx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># Build subcluster containing only stars in the full radial and mass range:</span>
    <span class="n">indx</span> <span class="o">*=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">r</span> <span class="o">&gt;=</span> <span class="n">rmin</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">rmax</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="n">mmin</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">&lt;=</span> <span class="n">mmax</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;=</span> <span class="n">vmin</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;=</span> <span class="n">vmax</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">kw</span> <span class="o">&gt;=</span> <span class="n">kwmin</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">kw</span> <span class="o">&lt;=</span> <span class="n">kwmax</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">emin</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indx</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">etot</span> <span class="o">&gt;=</span> <span class="n">emin</span>
    <span class="k">if</span> <span class="n">emin</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indx</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">etot</span> <span class="o">&lt;=</span> <span class="n">emax</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">nmass</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">omask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m_lower</span><span class="p">,</span> <span class="n">m_mean</span><span class="p">,</span> <span class="n">m_upper</span><span class="p">,</span> <span class="n">m_hist</span> <span class="o">=</span> <span class="n">nbinmaker</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">],</span> <span class="n">nmass</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">m_lower</span><span class="p">,</span> <span class="n">m_mean</span><span class="p">,</span> <span class="n">m_upper</span> <span class="o">=</span> <span class="n">omask</span><span class="o">.</span><span class="n">m_lower</span><span class="p">,</span> <span class="n">omask</span><span class="o">.</span><span class="n">m_mean</span><span class="p">,</span> <span class="n">omask</span><span class="o">.</span><span class="n">m_upper</span>
                <span class="n">nmass</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m_mean</span><span class="p">)</span>
                <span class="n">m_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nmass</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">m_lower</span><span class="p">,</span> <span class="n">m_mean</span><span class="p">,</span> <span class="n">m_upper</span><span class="p">,</span> <span class="n">m_hist</span> <span class="o">=</span> <span class="n">nbinmaker</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">],</span> <span class="n">nmass</span><span class="p">)</span>

        <span class="n">m_corr_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m_hist</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">m_hist</span><span class="p">)):</span>
            <span class="n">mindx</span> <span class="o">=</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="n">m_lower</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">&lt;</span> <span class="n">m_upper</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">indx</span>
            <span class="n">m_corr_hist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">mcorr</span><span class="p">[</span><span class="n">mindx</span><span class="p">])</span>
            <span class="n">m_hist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mindx</span><span class="p">)</span>

        <span class="n">mbincorr</span> <span class="o">=</span> <span class="n">m_hist</span> <span class="o">/</span> <span class="n">m_corr_hist</span>

        <span class="n">lm_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">m_mean</span><span class="p">)</span>
        <span class="n">dm</span> <span class="o">=</span> <span class="n">m_corr_hist</span> <span class="o">/</span> <span class="p">(</span><span class="n">m_upper</span> <span class="o">-</span> <span class="n">m_lower</span><span class="p">)</span>
        <span class="n">ldm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>

        <span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">yalpha</span><span class="p">),</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">lm_mean</span><span class="p">,</span> <span class="n">ldm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ealpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">eyalpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">nplot</span><span class="p">(</span><span class="n">m_mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dm</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;LOG(dN/dM)&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">mfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">m_mean</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">m_mean</span><span class="p">),</span> <span class="n">nmass</span><span class="p">)</span>
            <span class="n">dmfit</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mfit</span><span class="p">)</span> <span class="o">+</span> <span class="n">yalpha</span><span class="p">)</span>
            <span class="n">nlplot</span><span class="p">(</span>
                <span class="n">mfit</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dmfit</span><span class="p">),</span> <span class="n">overplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\alpha$ = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">alpha</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">m_mean</span><span class="p">,</span> <span class="n">m_corr_hist</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ealpha</span><span class="p">,</span> <span class="n">yalpha</span><span class="p">,</span> <span class="n">eyalpha</span><span class="p">,</span> <span class="n">mbincorr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NOT ENOUGH STARS TO ESTIMATE MASS FUNCTION&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nmass</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nmass</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nmass</span><span class="p">),</span>
            <span class="o">-</span><span class="mf">1000.0</span><span class="p">,</span>
            <span class="o">-</span><span class="mf">1000.0</span><span class="p">,</span>
            <span class="o">-</span><span class="mf">1000.0</span><span class="p">,</span>
            <span class="o">-</span><span class="mf">1000.0</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nmass</span><span class="p">),</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="obs_alpha_prof"><a class="viewcode-back" href="../../../reference/clustertools.observations.observations.html#clustertools.observations.observations.obs_alpha_prof">[docs]</a><span class="k">def</span> <span class="nf">obs_alpha_prof</span><span class="p">(</span>
    <span class="n">cluster</span><span class="p">,</span>
    <span class="n">mmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nmass</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">rmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nrad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">emin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">emax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">kwmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">kwmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">indx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mcorr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">projected</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">omask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       alpha_prof</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Measure the radial variation in the mass function</span>

<span class="sd">    INPUT:</span>

<span class="sd">       cluster - StarCluster instance</span>

<span class="sd">       mmin/mmax - minimum and maximum stellar mass</span>

<span class="sd">       nmass - number of mass bins to calculate slope of mass function</span>

<span class="sd">       rmin/rmax - minimum and maximum stellar radii</span>

<span class="sd">       nrad - number of radial bins</span>

<span class="sd">       vmin/vmax - minimum and maximum stellar velocity</span>

<span class="sd">       emin/emax - minimum and maximum stellar energy</span>

<span class="sd">       kwmin/kwmax - minimum and maximum stellar type (kw)</span>

<span class="sd">       indx - user defined boolean array from which to extract the subset</span>

<span class="sd">       mcorr - correction function for masses</span>

<span class="sd">       projected - use projected values and constraints (Default:False)</span>

<span class="sd">       omask - place a mask over the dataset and (WIP)</span>

<span class="sd">       plot - plot the density profile (Default: False)</span>

<span class="sd">    KWARGS:</span>

<span class="sd">       Same as for ..util.plot.nplot</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">        lrprofn - natural log of radius (normalized by half-mass radius)</span>

<span class="sd">        aprof - slope of the mass function</span>

<span class="sd">        dalpha - delta_alpha = d(alpha)/d(ln(r/rm) </span>

<span class="sd">        edalpha - error in dalpha</span>

<span class="sd">        ydalpha,eydalpha - y-intercept and error in fit to alpha vs ln(r/rm)</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">units0</span><span class="p">,</span> <span class="n">origin0</span> <span class="o">=</span> <span class="n">save_cluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">to_centre</span><span class="p">(</span><span class="n">do_order</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mcorr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">omask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">mcorr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">omask</span><span class="o">.</span><span class="n">mcorr</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">mcorr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ntot</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mcorr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ntot</span><span class="p">)</span>

    <span class="n">lrprofn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">aprof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

    <span class="k">if</span> <span class="n">projected</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rpro</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vpro</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">r</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">v</span>

    <span class="k">if</span> <span class="n">rmin</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rmax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vmin</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vmax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mmin</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mmax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwmin</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kwmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwmax</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kwmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">indx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># Build subcluster containing only stars in the full radial and mass range:</span>
    <span class="n">indx</span> <span class="o">*=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">r</span> <span class="o">&gt;=</span> <span class="n">rmin</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="n">rmax</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="n">mmin</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">&lt;=</span> <span class="n">mmax</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;=</span> <span class="n">vmin</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;=</span> <span class="n">vmax</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">kw</span> <span class="o">&gt;=</span> <span class="n">kwmin</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">kw</span> <span class="o">&lt;=</span> <span class="n">kwmax</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">emin</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indx</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">etot</span> <span class="o">&gt;=</span> <span class="n">emin</span>
    <span class="k">if</span> <span class="n">emin</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indx</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">etot</span> <span class="o">&lt;=</span> <span class="n">emax</span>

    <span class="k">if</span> <span class="n">omask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">r_lower</span><span class="p">,</span> <span class="n">r_mean</span><span class="p">,</span> <span class="n">r_upper</span><span class="p">,</span> <span class="n">r_hist</span> <span class="o">=</span> <span class="n">nbinmaker</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">indx</span><span class="p">],</span> <span class="n">nrad</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">r_lower</span><span class="p">,</span> <span class="n">r_mean</span><span class="p">,</span> <span class="n">r_upper</span> <span class="o">=</span> <span class="n">omask</span><span class="o">.</span><span class="n">r_lower</span><span class="p">,</span> <span class="n">omask</span><span class="o">.</span><span class="n">r_mean</span><span class="p">,</span> <span class="n">omask</span><span class="o">.</span><span class="n">r_upper</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">r_lower</span><span class="p">,</span> <span class="n">r_mean</span><span class="p">,</span> <span class="n">r_upper</span><span class="p">,</span> <span class="n">r_hist</span> <span class="o">=</span> <span class="n">nbinmaker</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">indx</span><span class="p">],</span> <span class="n">nrad</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DEBUG: &#39;</span><span class="p">,</span><span class="n">r_lower</span><span class="p">,</span><span class="n">r_mean</span><span class="p">,</span><span class="n">r_upper</span><span class="p">,</span><span class="n">omask</span><span class="o">.</span><span class="n">r_lower</span><span class="p">)</span>

    <span class="n">mbincorr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r_mean</span><span class="p">))</span>


    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_mean</span><span class="p">)):</span>
        <span class="n">rindx</span> <span class="o">=</span> <span class="n">indx</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;=</span> <span class="n">r_lower</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">r_upper</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">omask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m_mean</span><span class="p">,</span> <span class="n">m_hist</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ealpha</span><span class="p">,</span> <span class="n">yalpha</span><span class="p">,</span> <span class="n">eyalpha</span><span class="p">,</span> <span class="n">mbincorr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dx_corr_function</span><span class="p">(</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">rindx</span><span class="p">],</span> <span class="n">nmass</span><span class="p">,</span> <span class="n">mcorr</span><span class="p">[</span><span class="n">rindx</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">m_lower</span><span class="p">,</span> <span class="n">m_mean</span><span class="p">,</span> <span class="n">m_upper</span> <span class="o">=</span> <span class="n">omask</span><span class="o">.</span><span class="n">m_lower</span><span class="p">,</span> <span class="n">omask</span><span class="o">.</span><span class="n">m_mean</span><span class="p">,</span> <span class="n">omask</span><span class="o">.</span><span class="n">m_upper</span>

                <span class="n">m_mean</span><span class="p">,</span> <span class="n">m_hist</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ealpha</span><span class="p">,</span> <span class="n">yalpha</span><span class="p">,</span> <span class="n">eyalpha</span><span class="p">,</span> <span class="n">mbincorr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="n">dx_corr_function</span><span class="p">(</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">rindx</span><span class="p">],</span>
                    <span class="n">nmass</span><span class="p">,</span>
                    <span class="n">mcorr</span><span class="p">[</span><span class="n">rindx</span><span class="p">],</span>
                    <span class="n">x_lower</span><span class="o">=</span><span class="n">m_lower</span><span class="p">,</span>
                    <span class="n">x_mean</span><span class="o">=</span><span class="n">m_mean</span><span class="p">,</span>
                    <span class="n">x_upper</span><span class="o">=</span><span class="n">m_upper</span>
                <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">m_mean</span><span class="p">,</span> <span class="n">m_hist</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ealpha</span><span class="p">,</span> <span class="n">yalpha</span><span class="p">,</span> <span class="n">eyalpha</span><span class="p">,</span> <span class="n">mbincorr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="n">dx_corr_function</span><span class="p">(</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">rindx</span><span class="p">],</span>
                    <span class="n">nmass</span><span class="p">,</span>
                    <span class="n">mcorr</span><span class="p">[</span><span class="n">rindx</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">projected</span><span class="p">:</span>
            <span class="n">lrprofn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lrprofn</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r_mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rmpro</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lrprofn</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lrprofn</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r_mean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rm</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">100</span><span class="p">:</span>
            <span class="n">aprof</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aprof</span><span class="p">,</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aprof</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aprof</span><span class="p">,</span><span class="o">-</span><span class="mf">100.</span><span class="p">)</span>


    <span class="n">aindx</span><span class="o">=</span><span class="p">(</span><span class="n">aprof</span><span class="o">&gt;-</span><span class="mf">100.</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">aindx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="p">(</span><span class="n">dalpha</span><span class="p">,</span> <span class="n">ydalpha</span><span class="p">),</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">lrprofn</span><span class="p">[</span><span class="n">aindx</span><span class="p">],</span> <span class="n">aprof</span><span class="p">[</span><span class="n">aindx</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">edalpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">eydalpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dalpha</span> <span class="o">=</span> <span class="o">-</span><span class="mf">100.0</span>
        <span class="n">ydalpha</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">edalpha</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">eydalpha</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">overplot</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;overplot&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">nplot</span><span class="p">(</span>
            <span class="n">lrprofn</span><span class="p">,</span>
            <span class="n">aprof</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\ln(r/r_m)$&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\alpha$&quot;</span><span class="p">,</span>
            <span class="n">overplot</span><span class="o">=</span><span class="n">overplot</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="n">rfit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lrprofn</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lrprofn</span><span class="p">),</span> <span class="n">nrad</span><span class="p">)</span>
        <span class="n">afit</span> <span class="o">=</span> <span class="n">dalpha</span> <span class="o">*</span> <span class="n">rfit</span> <span class="o">+</span> <span class="n">ydalpha</span>
        <span class="n">nlplot</span><span class="p">(</span><span class="n">rfit</span><span class="p">,</span> <span class="n">afit</span><span class="p">,</span> <span class="n">overplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;d$\alpha$ = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">dalpha</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">dalpha</span> <span class="o">=</span> <span class="n">dalpha</span>

    <span class="n">return_cluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">units0</span><span class="p">,</span> <span class="n">origin0</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lrprofn</span><span class="p">,</span> <span class="n">aprof</span><span class="p">,</span> <span class="n">dalpha</span><span class="p">,</span> <span class="n">edalpha</span><span class="p">,</span> <span class="n">ydalpha</span><span class="p">,</span> <span class="n">eydalpha</span><span class="p">,</span> <span class="n">mbincorr</span></div>


<div class="viewcode-block" id="dx_corr_function"><a class="viewcode-back" href="../../../reference/clustertools.observations.observations.html#clustertools.observations.observations.dx_corr_function">[docs]</a><span class="k">def</span> <span class="nf">dx_corr_function</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> 
    <span class="n">nx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
    <span class="n">xcorr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
    <span class="n">bintype</span><span class="o">=</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> 
    <span class="n">x_lower</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
    <span class="n">x_mean</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
    <span class="n">x_upper</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  NAME:</span>

<span class="sd">     dx_function</span>

<span class="sd">  PURPOSE:</span>

<span class="sd">     Find distribution function using nx bins containing an equal number of points</span>
<span class="sd">  INPUT:</span>

<span class="sd">     x - input array</span>

<span class="sd">     nx - number of bins</span>

<span class="sd">     xcorr - correction function for x (default:None)</span>

<span class="sd">     bintype - bin with equal number of stars per bin (bin) or evenly in x (fix) (default: num)</span>

<span class="sd">     omask - place a mask over the dataset and (WIP)</span>

<span class="sd">  OUTPUT:</span>

<span class="sd">     x_mean,x_hist,dx,alpha,ealpha,yalpha,eyalpha</span>


<span class="sd">  HISTORY:</span>

<span class="sd">     2018 - Written - Webb (UofT)</span>

<span class="sd">  &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">x_lower</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bintype</span> <span class="o">==</span> <span class="s2">&quot;num&quot;</span><span class="p">:</span>
            <span class="n">x_lower</span><span class="p">,</span> <span class="n">x_mean</span><span class="p">,</span> <span class="n">x_upper</span><span class="p">,</span> <span class="n">x_hist</span> <span class="o">=</span> <span class="n">nbinmaker</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_lower</span><span class="p">,</span> <span class="n">x_mean</span><span class="p">,</span> <span class="n">x_upper</span><span class="p">,</span> <span class="n">x_hist</span> <span class="o">=</span> <span class="n">binmaker</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_lower</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xcorr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x_hist_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
        <span class="n">x_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_hist_corr</span><span class="p">)):</span>
            <span class="n">indx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">x_lower</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">x_upper</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">x_hist_corr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">xcorr</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span>
            <span class="n">x_hist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x_hist_corr</span><span class="o">=</span><span class="n">x_hist</span>

    <span class="n">xbincorr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">x_hist</span><span class="o">/</span><span class="n">x_hist_corr</span><span class="p">)</span>

    <span class="n">lx_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x_mean</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x_hist_corr</span> <span class="o">/</span> <span class="p">(</span><span class="n">x_upper</span> <span class="o">-</span> <span class="n">x_lower</span><span class="p">)</span>
    <span class="n">ldx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>

    <span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">yalpha</span><span class="p">),</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">lx_mean</span><span class="p">,</span> <span class="n">ldx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ealpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">eyalpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">V</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">x_mean</span><span class="p">,</span> <span class="n">x_hist</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">ealpha</span><span class="p">,</span> <span class="n">yalpha</span><span class="p">,</span> <span class="n">eyalpha</span><span class="p">,</span> <span class="n">xbincorr</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">clustertools 0.1.dev1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Jeremy J. Webb.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>