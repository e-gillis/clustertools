
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>clustertools.analysis.load &#8212; clustertools 0.1.dev1 documentation</title>
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">clustertools 0.1.dev1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for clustertools.analysis.load</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot; Read in cluster from Nbody simulations or generate an Nbody cluster</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Jeremy J Webb&quot;</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;load_cluster&quot;</span><span class="p">,</span>
    <span class="s2">&quot;advance_cluster&quot;</span>
<span class="p">]</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">galpy.util</span> <span class="kn">import</span> <span class="n">bovy_conversion</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">.cluster</span> <span class="kn">import</span> <span class="n">StarCluster</span>
<span class="kn">from</span> <span class="nn">.operations</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.orbit</span> <span class="kn">import</span> <span class="n">initialize_orbit</span>

<span class="c1"># Try Importing AMUSE. Only necessary for get_amuse_particles</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">amuse.units.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="load_cluster"><a class="viewcode-back" href="../../../reference/clustertools.analysis.load.html#clustertools.analysis.load.load_cluster">[docs]</a><span class="k">def</span> <span class="nf">load_cluster</span><span class="p">(</span>
    <span class="n">ctype</span><span class="o">=</span><span class="s2">&quot;snapshot&quot;</span><span class="p">,</span>
    <span class="n">particles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">custom_override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">units</span><span class="o">=</span><span class="s2">&quot;pckms&quot;</span><span class="p">,</span>
    <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span>
    <span class="n">ofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">orbit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       load_cluster</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Load a StarCluster snapshot from a generic code output</span>
<span class="sd">       --&gt; Note user can easily create their own def my_code() for new code output types</span>

<span class="sd">    INPUT:</span>

<span class="sd">       ctype - Type of file being loaded (Currently supports nbody6, nbody6se, gyrfalcon, snaptrim,snapauto, clustertools, snapshot)</span>

<span class="sd">       particles - AMUSE particle dataset (default: None)</span>

<span class="sd">       custom_override - use a custom function to load data instead of default (default: True)</span>

<span class="sd">       units - units of input data (default: kpckms)</span>

<span class="sd">       origin - origin of input data (default: cluster)</span>

<span class="sd">       ofile - an already opened file containing orbit information (default: None)</span>

<span class="sd">       orbit - a galpy orbit to be used for the StarCluster&#39;s orbital information (default: None)</span>

<span class="sd">       filename - name of file to be opened (optional - necessary if no defaults assigned to ctype) (default: None)</span>

<span class="sd">    KWARGS:</span>

<span class="sd">        ofilename - orbit filename if ofile is not given</span>

<span class="sd">        ounits - units of orbital information (else assumed equal to StarCluster.units)</span>

<span class="sd">        nsnap - if a specific snapshot is to be read in instead of starting from zero</span>
<span class="sd">    </span>
<span class="sd">        nzfill - value for zfill when reading and writing snapshots (Default: 5)</span>
<span class="sd">    </span>
<span class="sd">        delimiter - choice of delimiter when reading ascii/csv files (Default: &#39;,&#39;)</span>
<span class="sd">    </span>
<span class="sd">        wdir - working directory of snapshots if not current directory</span>

<span class="sd">        intialize - initialize a galpy orbit after reading in orbital information (default: False)</span>

<span class="sd">        projected - calculate projected values as well as 3D values (Default: True)</span>

<span class="sd">        do_key_params - calculate key parameters</span>

<span class="sd">        do_rorder - sort stars in order from closes to the origin to the farthest</span>


<span class="sd">    OUTPUT:</span>

<span class="sd">       StarCluster instance</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">wdir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;wdir&quot;</span><span class="p">,</span> <span class="s2">&quot;./&quot;</span><span class="p">)</span>
    <span class="n">initialize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;initialize&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;ofilename&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">ofile</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ofile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">wdir</span> <span class="o">+</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ofilename&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s2">&quot;nbody6se&quot;</span><span class="p">:</span>
        <span class="c1"># When stellar evolution is turned on, read in fort.82 and fort.83 and if possible gc_orbit.dat</span>
        <span class="n">fort82</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">fort.82&quot;</span> <span class="o">%</span> <span class="n">wdir</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">fort83</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">fort.83&quot;</span> <span class="o">%</span> <span class="n">wdir</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">custom_override</span><span class="p">:</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">get_nbody6se_custom</span><span class="p">(</span>
                <span class="n">fort82</span><span class="p">,</span> <span class="n">fort83</span><span class="p">,</span> <span class="n">ofile</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">get_nbody6se</span><span class="p">(</span>
                <span class="n">fort82</span><span class="p">,</span> <span class="n">fort83</span><span class="p">,</span> <span class="n">ofile</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

    <span class="k">elif</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s2">&quot;nbody6&quot;</span><span class="p">:</span>
        <span class="c1"># With stellar evolution turned off, read in OUT9 and OUT34. Orbit data already in OUT34</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">OUT9&quot;</span> <span class="o">%</span> <span class="n">wdir</span><span class="p">):</span>
            <span class="n">out9</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">OUT9&quot;</span> <span class="o">%</span> <span class="n">wdir</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out9</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">out34</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">OUT34&quot;</span> <span class="o">%</span> <span class="n">wdir</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">custom_override</span><span class="p">:</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">get_nbody6_custom</span><span class="p">(</span><span class="n">out9</span><span class="p">,</span> <span class="n">out34</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">get_nbody6</span><span class="p">(</span><span class="n">out9</span><span class="p">,</span> <span class="n">out34</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s2">&quot;gyrfalcon&quot;</span><span class="p">:</span>
        <span class="c1"># Read in snapshot from gyrfalcon.</span>
        <span class="n">filein</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">wdir</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">get_gyrfalcon</span><span class="p">(</span><span class="n">filein</span><span class="p">,</span> <span class="s2">&quot;WDunits&quot;</span><span class="p">,</span> <span class="s2">&quot;galaxy&quot;</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ctype</span><span class="o">==</span><span class="s1">&#39;amuse&#39;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">=</span><span class="n">get_amuse_particles</span><span class="p">(</span><span class="n">particles</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">ofile</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s2">&quot;snapshot&quot;</span><span class="p">:</span>
        <span class="c1"># Read in standard generic snapshot</span>
        <span class="n">col_names</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;col_names&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;vx&quot;</span><span class="p">,</span> <span class="s2">&quot;vy&quot;</span><span class="p">,</span> <span class="s2">&quot;vz&quot;</span><span class="p">])</span>
        <span class="n">col_nums</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;col_nums&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">get_snapshot</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">col_names</span><span class="o">=</span><span class="n">col_names</span><span class="p">,</span>
            <span class="n">col_nums</span><span class="o">=</span><span class="n">col_nums</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
            <span class="n">ofile</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span>
            <span class="n">advance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NO CTYPE GIVEN&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># Add galpy orbit if given</span>
    <span class="k">if</span> <span class="n">orbit</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">orbit</span> <span class="o">=</span> <span class="n">orbit</span>
        <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;pckms&quot;</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">tphys</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">bovy_conversion</span><span class="o">.</span><span class="n">time_in_Gyr</span><span class="p">(</span><span class="n">ro</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">vo</span><span class="o">=</span><span class="mf">220.0</span><span class="p">)</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">add_orbit</span><span class="p">(</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">,</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">,</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1000.0</span><span class="p">,</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vx</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vy</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vz</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;kpckms&quot;</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">add_orbit</span><span class="p">(</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vx</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vy</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vz</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;nbody&quot;</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">tphys</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">tstar</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">bovy_conversion</span><span class="o">.</span><span class="n">time_in_Gyr</span><span class="p">(</span>
                <span class="n">ro</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">vo</span><span class="o">=</span><span class="mf">220.0</span>
            <span class="p">)</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">add_orbit</span><span class="p">(</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1000.0</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span><span class="p">,</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1000.0</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span><span class="p">,</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1000.0</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span><span class="p">,</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vx</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span><span class="p">,</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vy</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span><span class="p">,</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vz</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;galpy&quot;</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">tphys</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">add_orbit</span><span class="p">(</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="mf">8.0</span><span class="p">,</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="mf">8.0</span><span class="p">,</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="mf">8.0</span><span class="p">,</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vx</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="mf">220.0</span><span class="p">,</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vy</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="mf">220.0</span><span class="p">,</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vz</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="mf">220.0</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">units0</span><span class="p">,</span> <span class="n">origin0</span> <span class="o">=</span> <span class="n">save_cluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">to_cluster</span><span class="p">()</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">find_centre</span><span class="p">()</span>

        <span class="n">return_cluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">units0</span><span class="p">,</span> <span class="n">origin0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">initialize</span><span class="p">:</span>
        <span class="n">initialize_orbit</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>

    <span class="c1"># cluster.key_params()</span>

    <span class="k">return</span> <span class="n">cluster</span></div>


<div class="viewcode-block" id="advance_cluster"><a class="viewcode-back" href="../../../reference/clustertools.analysis.load.html#clustertools.analysis.load.advance_cluster">[docs]</a><span class="k">def</span> <span class="nf">advance_cluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span><span class="n">custom_override</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">orbit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       advance_cluster</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Advance a loaded StarCluster snapshot to the next timestep</span>
<span class="sd">       --&gt; ofile or orbit need to be provded again, same as load_cluster.</span>
<span class="sd">       --&gt; Be sure that advance is set to True so next line of orbit file is read in</span>

<span class="sd">    INPUT:</span>

<span class="sd">       cluster - StarCluster instance to be advanced</span>

<span class="sd">       custom_override - use a custom function to load data instead of default</span>

<span class="sd">       ofile - an already opened file containing orbit information (default: None)</span>

<span class="sd">       orbit - a galpy orbit to be used for the StarCluster&#39;s orbital information (default: None)</span>

<span class="sd">       filename - name of file to be opened (optional - necessary if no defaults assigned to ctype) (default: None)</span>

<span class="sd">    KWARGS:</span>

<span class="sd">        same as load_cluster</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       StarCluster instance</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">advance_kwargs</span> <span class="o">=</span> <span class="n">get_advanced_kwargs</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Continue reading in cluster opened in get_cluster()</span>
    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">ctype</span> <span class="o">==</span> <span class="s2">&quot;nbody6se&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">custom_override</span><span class="p">:</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">get_nbody6se_custom</span><span class="p">(</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">bfile</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">sfile</span><span class="p">,</span> <span class="n">ofile</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">advance_kwargs</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">get_nbody6se</span><span class="p">(</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">bfile</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">sfile</span><span class="p">,</span> <span class="n">ofile</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">advance_kwargs</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">ctype</span> <span class="o">==</span> <span class="s2">&quot;nbody6&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">custom_override</span><span class="p">:</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">get_nbody6</span><span class="p">(</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">bfile</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">sfile</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">advance_kwargs</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">get_nbody6</span><span class="p">(</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">bfile</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">sfile</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">advance_kwargs</span>
            <span class="p">)</span>

    <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">ctype</span> <span class="o">==</span> <span class="s2">&quot;gyrfalcon&quot;</span><span class="p">:</span>

        <span class="n">cluster</span> <span class="o">=</span> <span class="n">get_gyrfalcon</span><span class="p">(</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">sfile</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;WDunits&quot;</span><span class="p">,</span>
            <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;galaxy&quot;</span><span class="p">,</span>
            <span class="n">ofile</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span>
            <span class="n">advance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">advance_kwargs</span>
        <span class="p">)</span>


    <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">ctype</span> <span class="o">==</span> <span class="s2">&quot;snapshot&quot;</span><span class="p">:</span>
        <span class="n">col_names</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;col_names&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;vx&quot;</span><span class="p">,</span> <span class="s2">&quot;vy&quot;</span><span class="p">,</span> <span class="s2">&quot;vz&quot;</span><span class="p">])</span>
        <span class="n">col_nums</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;col_nums&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

        <span class="n">cluster</span> <span class="o">=</span> <span class="n">get_snapshot</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">col_names</span><span class="o">=</span><span class="n">col_names</span><span class="p">,</span>
            <span class="n">col_nums</span><span class="o">=</span><span class="n">col_nums</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="n">cluster</span><span class="o">.</span><span class="n">units</span><span class="p">,</span>
            <span class="n">origin</span><span class="o">=</span><span class="n">cluster</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span>
            <span class="n">ofile</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span>
            <span class="n">advance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">advance_kwargs</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">StarCuster</span><span class="p">(</span><span class="n">ctype</span><span class="o">=</span><span class="n">cluster</span><span class="o">.</span><span class="n">ctype</span><span class="p">)</span>

    <span class="c1"># Check for restart</span>
    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">ntot</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NTOT = 0&#39;</span><span class="p">,</span><span class="n">cluster</span><span class="o">.</span><span class="n">wdir</span><span class="p">,</span><span class="n">advance_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;wdir&#39;</span><span class="p">,</span><span class="s1">&#39;./&#39;</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wdir</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">wdir</span> <span class="o">+</span> <span class="s2">&quot;cont/&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WDIR NOT SET&quot;</span><span class="p">)</span>
            <span class="n">wdir</span> <span class="o">=</span> <span class="s2">&quot;./cont/&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ofilename</span> <span class="o">=</span> <span class="n">ofile</span><span class="o">.</span><span class="n">name</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OFILE NOT SET&quot;</span><span class="p">)</span>
            <span class="n">ofile</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">wdir</span><span class="p">):</span>
            <span class="n">old_wdir</span><span class="o">=</span><span class="n">advance_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;wdir&#39;</span><span class="p">)</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">load_cluster</span><span class="p">(</span>
                <span class="n">ctype</span><span class="o">=</span><span class="n">cluster</span><span class="o">.</span><span class="n">ctype</span><span class="p">,</span> <span class="n">ofile</span><span class="o">=</span><span class="n">ofile</span><span class="p">,</span> <span class="n">wdir</span><span class="o">=</span><span class="n">wdir</span><span class="p">,</span> <span class="o">**</span><span class="n">advance_kwargs</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">ntot</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>

        <span class="c1"># Add galpy orbit if given</span>
        <span class="k">if</span> <span class="n">orbit</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">orbit</span> <span class="o">-</span> <span class="n">orbit</span>
            <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;pckms&quot;</span> <span class="ow">or</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;kpckms&quot;</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">tphys</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">bovy_conversion</span><span class="o">.</span><span class="n">time_in_Gyr</span><span class="p">(</span>
                    <span class="n">ro</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">vo</span><span class="o">=</span><span class="mf">220.0</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;nbody&quot;</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">tphys</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">tstar</span> <span class="o">/</span> <span class="mf">1000.0</span>
                <span class="p">)</span> <span class="o">/</span> <span class="n">bovy_conversion</span><span class="o">.</span><span class="n">time_in_Gyr</span><span class="p">(</span><span class="n">ro</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">vo</span><span class="o">=</span><span class="mf">220.0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;galpy&quot;</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">tphys</span>

            <span class="n">cluster</span><span class="o">.</span><span class="n">add_orbit</span><span class="p">(</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">y</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">z</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vx</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vy</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
                <span class="n">orbit</span><span class="o">.</span><span class="n">vz</span><span class="p">(</span><span class="n">t</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">key_params</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">cluster</span></div>


<span class="k">def</span> <span class="nf">get_advanced_kwargs</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       get_advanced_kwargs</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       get **kwargs from current cluster before advancing</span>

<span class="sd">    INPUT:</span>

<span class="sd">       cluster - StarCluster instance</span>

<span class="sd">    KWARGS:</span>

<span class="sd">        same a load_cluster</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2019 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nsnap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nsnap&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">cluster</span><span class="o">.</span><span class="n">nsnap</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">delimiter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;delimiter&quot;</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">delimiter</span><span class="p">)</span>
    <span class="n">wdir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;wdir&quot;</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">wdir</span><span class="p">)</span>
    <span class="n">nzfill</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nzfill&quot;</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">nzfill</span><span class="p">))</span>
    <span class="n">snapbase</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;snapbase&quot;</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">snapbase</span><span class="p">)</span>
    <span class="n">snapend</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;snapend&quot;</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">snapend</span><span class="p">)</span>
    <span class="n">snapdir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;snapdir&quot;</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">snapdir</span><span class="p">)</span>
    <span class="n">skiprows</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;skiprows&quot;</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">skiprows</span><span class="p">)</span>

    <span class="n">projected</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projected&quot;</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">projected</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;nsnap&quot;</span><span class="p">:</span> <span class="n">nsnap</span><span class="p">,</span>
        <span class="s2">&quot;delimiter&quot;</span><span class="p">:</span> <span class="n">delimiter</span><span class="p">,</span>
        <span class="s2">&quot;wdir&quot;</span><span class="p">:</span> <span class="n">wdir</span><span class="p">,</span>
        <span class="s2">&quot;nzfill&quot;</span><span class="p">:</span> <span class="n">nzfill</span><span class="p">,</span>
        <span class="s2">&quot;snapbase&quot;</span><span class="p">:</span> <span class="n">snapbase</span><span class="p">,</span>
        <span class="s2">&quot;snapend&quot;</span><span class="p">:</span> <span class="n">snapend</span><span class="p">,</span>
        <span class="s2">&quot;snapdir&quot;</span><span class="p">:</span> <span class="n">snapdir</span><span class="p">,</span>
        <span class="s2">&quot;skiprows&quot;</span><span class="p">:</span> <span class="n">skiprows</span><span class="p">,</span>
        <span class="s2">&quot;projected&quot;</span><span class="p">:</span> <span class="n">projected</span><span class="p">,</span>
    <span class="p">}</span>  <span class="c1"># ,&quot;sfile&quot;:sfile,&quot;bfile&quot;:bfile}</span>


<span class="k">def</span> <span class="nf">get_cluster_orbit</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       get_cluster_orbit</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Read in cluster oribit from an ascii file and apply it to StarCluster instance</span>
<span class="sd">        --&gt;Columns assumed to be time,x,y,z,vx,vy,vz.</span>
<span class="sd">        --&gt;As I have hardcoded for gc_orbit.dat, if a certain filename is commonly used</span>
<span class="sd">        with specific columns, an if statement can easily be added.</span>
<span class="sd">            --&gt; Note that gc_orbit.dat comes from running &#39;grep &#39;CLUSTER ORBIT&#39; logfile &gt; gc_orbit.dat&#39; on </span>
<span class="sd">            the standard Nbody6 logfile</span>

<span class="sd">    INPUT:</span>

<span class="sd">       cluster - StarCluster instance</span>

<span class="sd">       ofile - opened orbit file</span>

<span class="sd">    KWARGS:</span>

<span class="sd">        advance - Is this a continuation from a previous timestep, in which case read next line (default: False)</span>
<span class="sd">        nsnap - if nsnap is provided, read line # nsnap from the orbit file</span>
<span class="sd">        ounits - if you units are not the same as StarCluster units, provide them and they will be converted</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nsnap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nsnap&quot;</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">nsnap</span><span class="p">))</span>
    <span class="n">ounits</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ounits&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Read in orbital information from orbit</span>
    <span class="k">if</span> <span class="n">nsnap</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">advance</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">nsnap</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">ofile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ofile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="k">if</span> <span class="s2">&quot;gc_orbit.dat&quot;</span> <span class="ow">in</span> <span class="n">ofile</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
        <span class="c1"># Saved orbit from doing a grep of NBODY6 or NBODY6++ logfile</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">18</span><span class="p">:</span>
            <span class="n">xgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
            <span class="n">ygc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
            <span class="n">zgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span>
            <span class="n">vxgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
            <span class="n">vygc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
            <span class="n">vzgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
            <span class="n">ygc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
            <span class="n">zgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
            <span class="n">vxgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span>
            <span class="n">vygc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
            <span class="n">vzgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tphys</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">xgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ygc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">zgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">vxgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">vygc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">vzgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">tphys</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">tphys</span> <span class="o">=</span> <span class="n">tphys</span>

    <span class="k">if</span> <span class="n">ounits</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;gc_orbit.dat&quot;</span> <span class="ow">in</span> <span class="n">ofile</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
        <span class="n">ounits</span> <span class="o">=</span> <span class="s2">&quot;kpckms&quot;</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">add_orbit</span><span class="p">(</span><span class="n">xgc</span><span class="p">,</span> <span class="n">ygc</span><span class="p">,</span> <span class="n">zgc</span><span class="p">,</span> <span class="n">vxgc</span><span class="p">,</span> <span class="n">vygc</span><span class="p">,</span> <span class="n">vzgc</span><span class="p">,</span> <span class="n">ounits</span><span class="p">)</span>

    <span class="k">return</span>

<span class="c1"># Get StarCluster from Gyrfalcon output</span>
<span class="k">def</span> <span class="nf">get_gyrfalcon</span><span class="p">(</span>
    <span class="n">filein</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;WDunits&quot;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;galaxy&quot;</span><span class="p">,</span> <span class="n">ofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       get_gyrfalcon</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Extract a single snapshot from an ascii file output from a gyrfalcon simulation</span>

<span class="sd">    INPUT:</span>

<span class="sd">       filein - opened gyrfalcon file</span>

<span class="sd">       units - units of data (default:&#39;WDunits&#39;)</span>

<span class="sd">       ofile - opened file containing orbital information</span>

<span class="sd">       advance - is this a snapshot that has been advanced to from initial load_cluster?</span>


<span class="sd">    KWARGS:</span>

<span class="sd">        same as load_cluster</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       StarCluster instance</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;WDunits&quot;</span><span class="p">:</span>
        <span class="n">vcon</span> <span class="o">=</span> <span class="mf">220.0</span> <span class="o">/</span> <span class="n">bovy_conversion</span><span class="o">.</span><span class="n">velocity_in_kpcGyr</span><span class="p">(</span><span class="mf">220.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">)</span>
        <span class="n">mcon</span> <span class="o">=</span> <span class="mf">222288.4543021174</span>
        <span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;kpckms&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vcon</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">mcon</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># Default **kwargs</span>
    <span class="n">skiprows</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;skiprows&quot;</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>

    <span class="n">i_d</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">vx</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">over_head</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">ntot</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">tphys</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">skiprows</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">filein</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;#&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">over_head</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OVER HEAD&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;END OF FILE&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">StarCluster</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">ctype</span><span class="o">=</span><span class="s2">&quot;gyrfalcon&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;Ntot&quot;</span> <span class="ow">in</span> <span class="n">dat</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">data</span><span class="p">):</span>
            <span class="n">sntot</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">ntot</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sntot</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="n">dat</span> <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">data</span><span class="p">):</span>
            <span class="n">tphys</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1000.0</span>

    <span class="n">cluster</span> <span class="o">=</span> <span class="n">StarCluster</span><span class="p">(</span>
        <span class="n">ntot</span><span class="p">,</span>
        <span class="n">tphys</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
        <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
        <span class="n">ctype</span><span class="o">=</span><span class="s2">&quot;gyrfalcon&quot;</span><span class="p">,</span>
        <span class="n">sfile</span><span class="o">=</span><span class="n">filein</span><span class="p">,</span>
        <span class="n">bfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">skiprows</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntot</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">over_head</span><span class="p">:</span>
            <span class="n">over_head</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">filein</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">i_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">mcon</span><span class="p">)</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">vx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">*</span> <span class="n">vcon</span><span class="p">)</span>
        <span class="n">vy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="o">*</span> <span class="n">vcon</span><span class="p">)</span>
        <span class="n">vz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">*</span> <span class="n">vcon</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ntot</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">add_stars</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">i_d</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ofile</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">find_centre</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get_cluster_orbit</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="n">advance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;do_key_params&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">do_order</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;do_key_params&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_cluster</span><span class="p">()</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">find_centre</span><span class="p">()</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_centre</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">)</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_galaxy</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">cluster</span>

<span class="k">def</span> <span class="nf">get_nbody6se</span><span class="p">(</span><span class="n">fort82</span><span class="p">,</span> <span class="n">fort83</span><span class="p">,</span> <span class="n">ofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WORK IN PROGRESS&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">StarCluster</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">get_nbody6se_custom</span><span class="p">(</span><span class="n">fort82</span><span class="p">,</span> <span class="n">fort83</span><span class="p">,</span> <span class="n">ofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       get_nbody6_jarrod</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Extract a single snapshot from the fort.82 and fort.83 files output by Jarrod Hurleys version of Nbody6</span>
<span class="sd">       --&gt; Difference between Jarrod&#39;s output and the public version is found in /Node/hrplot.f of Nbody6</span>
<span class="sd">       --&gt; Called for Nbody6 simulations with stellar evolution</span>

<span class="sd">    INPUT:</span>

<span class="sd">       fort82 - opened fort.82 file containing binary star information</span>

<span class="sd">       fort83 - opened fort.83 file containing single star information</span>

<span class="sd">       ofile - opened file containing orbital information</span>

<span class="sd">       advance - is this a snapshot that has been advanced to from initial load_cluster?</span>

<span class="sd">    KWARGS:</span>

<span class="sd">        same as load_cluster</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       StarCluster instance</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">line1</span> <span class="o">=</span> <span class="n">fort83</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;END OF FILE&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">StarCluster</span><span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span><span class="n">ctype</span><span class="o">=</span><span class="s1">&#39;nbody6se&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">line2</span> <span class="o">=</span> <span class="n">fort83</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">line3</span> <span class="o">=</span> <span class="n">fort83</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">line1b</span> <span class="o">=</span> <span class="n">fort82</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="n">ns</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">tphys</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">nc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="n">rbar</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">rtide</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">xc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">yc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">zc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
    <span class="n">zmbar</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">vstar</span> <span class="o">=</span> <span class="mf">0.06557</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">zmbar</span> <span class="o">/</span> <span class="n">rbar</span><span class="p">)</span>
    <span class="n">rscale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line3</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">nb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line1b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ntot</span> <span class="o">=</span> <span class="n">ns</span> <span class="o">+</span> <span class="n">nb</span>

    <span class="n">nsbnd</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nbbnd</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nbnd</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">i_d</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">id1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">id2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kw1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kw2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kcm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ecc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pb</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">semi</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">logl1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">logl2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">logl</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">logr1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">logr2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">logr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rxy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">vx</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ep</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ep1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ep2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ospin</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ospin1</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ospin2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kin</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pot</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">etot</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">fort82</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="k">while</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">id1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">id2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">i_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">id1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">kw1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">kw2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">kw1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">kw2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">kcm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">ecc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
        <span class="n">pb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">10.0</span><span class="o">**</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
        <span class="n">semi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">10.0</span><span class="o">**</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
        <span class="n">m1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span> <span class="o">/</span> <span class="n">zmbar</span><span class="p">)</span>
        <span class="n">m2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span> <span class="o">/</span> <span class="n">zmbar</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">m2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">logl1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>
        <span class="n">logl2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">]))</span>
        <span class="n">logl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">logl1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">logl2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">logr1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">]))</span>
        <span class="n">logr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">]))</span>
        <span class="n">logr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">logr1</span><span class="p">,</span> <span class="n">logr2</span><span class="p">))</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">]))</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">15</span><span class="p">]))</span>
        <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">16</span><span class="p">]))</span>
        <span class="n">vx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">17</span><span class="p">]))</span>
        <span class="n">vy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">18</span><span class="p">]))</span>
        <span class="n">vz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">19</span><span class="p">]))</span>

        <span class="k">if</span> <span class="s2">&quot;bnd&quot;</span> <span class="ow">in</span> <span class="n">fort82</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;esc&quot;</span> <span class="ow">in</span> <span class="n">fort82</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">kin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">20</span><span class="p">]))</span>
            <span class="n">pot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">21</span><span class="p">]))</span>
            <span class="n">etot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">23</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">pot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">etot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">ep1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">20</span><span class="p">]))</span>
            <span class="n">ep2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">21</span><span class="p">]))</span>
            <span class="n">ospin1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">22</span><span class="p">]))</span>
            <span class="n">ospin2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">23</span><span class="p">]))</span>

            <span class="n">ep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ep1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ospin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ospin1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">nbbnd</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fort82</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">fort83</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">while</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">i_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">zmbar</span><span class="p">)</span>
        <span class="n">logl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">logr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
        <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
        <span class="n">vx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
        <span class="n">vy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>
        <span class="n">vz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>

        <span class="k">if</span> <span class="s2">&quot;bnd&quot;</span> <span class="ow">in</span> <span class="n">fort83</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;esc&quot;</span> <span class="ow">in</span> <span class="n">fort83</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">kin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">]))</span>
            <span class="n">pot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">]))</span>
            <span class="n">etot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">pot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">etot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">ep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">]))</span>
            <span class="n">ospin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">]))</span>

        <span class="n">nsbnd</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fort83</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="n">nbnd</span> <span class="o">=</span> <span class="n">nsbnd</span> <span class="o">+</span> <span class="n">nbbnd</span>

    <span class="k">if</span> <span class="n">nbnd</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">StarCluster</span><span class="p">(</span>
            <span class="n">nbnd</span><span class="p">,</span>
            <span class="n">tphys</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;nbody&quot;</span><span class="p">,</span>
            <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span>
            <span class="n">ctype</span><span class="o">=</span><span class="s2">&quot;nbody6se&quot;</span><span class="p">,</span>
            <span class="n">sfile</span><span class="o">=</span><span class="n">fort83</span><span class="p">,</span>
            <span class="n">bfile</span><span class="o">=</span><span class="n">fort82</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">add_nbody6</span><span class="p">(</span>
            <span class="n">nc</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">rbar</span><span class="p">,</span> <span class="n">rtide</span><span class="p">,</span> <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">zc</span><span class="p">,</span> <span class="n">zmbar</span><span class="p">,</span> <span class="n">vstar</span><span class="p">,</span> <span class="n">rscale</span><span class="p">,</span> <span class="n">nsbnd</span><span class="p">,</span> <span class="n">nbbnd</span>
        <span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">add_stars</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">i_d</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">add_sse</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="n">logl</span><span class="p">,</span> <span class="n">logr</span><span class="p">,</span> <span class="n">ep</span><span class="p">,</span> <span class="n">ospin</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">add_bse</span><span class="p">(</span>
            <span class="n">id1</span><span class="p">,</span>
            <span class="n">id2</span><span class="p">,</span>
            <span class="n">kw1</span><span class="p">,</span>
            <span class="n">kw2</span><span class="p">,</span>
            <span class="n">kcm</span><span class="p">,</span>
            <span class="n">ecc</span><span class="p">,</span>
            <span class="n">pb</span><span class="p">,</span>
            <span class="n">semi</span><span class="p">,</span>
            <span class="n">m1</span><span class="p">,</span>
            <span class="n">m2</span><span class="p">,</span>
            <span class="n">logl1</span><span class="p">,</span>
            <span class="n">logl2</span><span class="p">,</span>
            <span class="n">logr1</span><span class="p">,</span>
            <span class="n">logr2</span><span class="p">,</span>
            <span class="n">ep1</span><span class="p">,</span>
            <span class="n">ep2</span><span class="p">,</span>
            <span class="n">ospin1</span><span class="p">,</span>
            <span class="n">ospin2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">add_energies</span><span class="p">(</span><span class="n">kin</span><span class="p">,</span> <span class="n">pot</span><span class="p">,</span> <span class="n">etot</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ofile</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">get_cluster_orbit</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="n">advance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;do_key_params&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">do_order</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;do_order&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Estimate centre</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">find_centre</span><span class="p">()</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_centre</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">)</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_cluster</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">StarCluster</span><span class="p">(</span> <span class="n">tphys</span><span class="p">,</span> <span class="n">ctype</span><span class="o">=</span><span class="s2">&quot;nbody6se&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cluster</span>

<span class="k">def</span> <span class="nf">get_nbody6</span><span class="p">(</span><span class="n">out9</span><span class="p">,</span> <span class="n">out34</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WORK IN PROGRESS&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">StarCluster</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">get_nbody6_custom</span><span class="p">(</span><span class="n">out9</span><span class="p">,</span> <span class="n">out34</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       get_nbody6_out34</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Extract a single snapshot from the OUT9 and OUT34 output of Jeremy Webb&#39;s version of Nbody6</span>
<span class="sd">       --&gt; Difference between Jeremy&#39;s output and the public version is found in /Node/output.f of Nbody6</span>
<span class="sd">       --&gt; Called for Nbody6 simulations without stellar evolution</span>

<span class="sd">    INPUT:</span>

<span class="sd">       out9 - opened OUT34 file containing binary star information</span>

<span class="sd">       out34 - opened OUT34 file containing single star information</span>

<span class="sd">       ofile - opened file containing orbital information</span>

<span class="sd">       advance - is this a snapshot that has been advanced to from initial load_cluster?</span>

<span class="sd">    KWARGS:</span>

<span class="sd">        same as load_cluster</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       StarCluster instance</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">line1</span> <span class="o">=</span> <span class="n">out34</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;END OF FILE&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">StarCluster</span><span class="p">(</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">ctype</span><span class="o">=</span><span class="s1">&#39;nbody6&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">line2</span> <span class="o">=</span> <span class="n">out34</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">line3</span> <span class="o">=</span> <span class="n">out34</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="n">ns</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">tphys</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">n_p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">11</span><span class="p">:</span>
        <span class="n">nb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">11</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nb</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">out9</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">line1b</span> <span class="o">=</span> <span class="n">out9</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">line2b</span> <span class="o">=</span> <span class="n">out9</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">line3b</span> <span class="o">=</span> <span class="n">out9</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">nb</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line1b</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: NUMBER OF BINARIES DO NOT MATCH - &quot;</span><span class="p">,</span><span class="n">nb</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">line1b</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="n">nc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="n">rbar</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">rtide</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">xc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">yc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">zc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line2</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
    <span class="n">zmbar</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">vstar</span> <span class="o">=</span> <span class="mf">0.06557</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">zmbar</span> <span class="o">/</span> <span class="n">rbar</span><span class="p">)</span>
    <span class="n">rscale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line3</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">ntot</span> <span class="o">=</span> <span class="n">ns</span> <span class="o">+</span> <span class="n">nb</span>

    <span class="c1"># Orbital Properties</span>
    <span class="n">xgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">ygc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
    <span class="n">zgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
    <span class="n">vxgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
    <span class="n">vygc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
    <span class="n">vzgc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line1</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>

    <span class="n">nsbnd</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nbbnd</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nbnd</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">i_d</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">logl</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">logr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">vx</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kin</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pot</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">etot</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">out9</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">yrs</span> <span class="o">=</span> <span class="p">(</span><span class="n">rbar</span> <span class="o">*</span> <span class="mf">1296000.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">**</span> <span class="mf">1.5</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">zmbar</span><span class="p">)</span>
        <span class="n">days</span> <span class="o">=</span> <span class="mf">365.25</span> <span class="o">*</span> <span class="n">yrs</span>

        <span class="n">id1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kw1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">logl1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">logr1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">id2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kw2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">logl2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">logr2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kcm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ecc</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">semi</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">out9</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

            <span class="c1">#Ignore massless ghost particles ouput by NBODY6</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                <span class="n">nbbnd</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">ecc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">m1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">/</span> <span class="n">zmbar</span><span class="p">)</span>
                <span class="n">m2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="o">/</span> <span class="n">zmbar</span><span class="p">)</span>
                <span class="n">pb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">/</span> <span class="n">days</span><span class="p">)</span>
                <span class="n">id1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">])))</span>
                <span class="n">id2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">])))</span>
                <span class="n">kw1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>
                <span class="n">kw2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>
                <span class="n">kcm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">]))</span>

                <span class="n">logl1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="n">logl2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="n">logr1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="n">logr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

                <span class="n">x1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>
                <span class="n">z1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
                <span class="n">vx1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
                <span class="n">vy1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span>
                <span class="n">vz1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">17</span><span class="p">])</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">18</span><span class="p">])</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">19</span><span class="p">])</span>
                <span class="n">z2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">20</span><span class="p">])</span>
                <span class="n">vx2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">21</span><span class="p">])</span>
                <span class="n">vy2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">22</span><span class="p">])</span>
                <span class="n">vz2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">23</span><span class="p">])</span>

                <span class="sd">&#39;&#39;&#39; It seems binary COM information is included in OUT34</span>
<span class="sd">                x.append((x1 * m1[-1] + x2 * m2[-1]) / (m1[-1] + m2[-1]) + xc)</span>
<span class="sd">                y.append((y1 * m1[-1] + y2 * m2[-1]) / (m1[-1] + m2[-1]) + yc)</span>
<span class="sd">                z.append((z1 * m1[-1] + z2 * m2[-1]) / (m1[-1] + m2[-1]) + zc)</span>
<span class="sd">                vx.append((vx1 * m1[-1] + vx2 * m2[-1]) / (m1[-1] + m2[-1]))</span>
<span class="sd">                vy.append((vy1 * m1[-1] + vy2 * m2[-1]) / (m1[-1] + m2[-1]))</span>
<span class="sd">                vz.append((vz1 * m1[-1] + vz2 * m2[-1]) / (m1[-1] + m2[-1]))</span>
<span class="sd">                m.append(m1[-1] + m2[-1])</span>
<span class="sd">                i_d.append(id1[-1])</span>
<span class="sd">                kw.append(max(kw1[-1], kw2[-1]))</span>
<span class="sd">                logl.append(1.0)</span>
<span class="sd">                logr.append(1.0)</span>
<span class="sd">                </span>

<span class="sd">                r1 = np.sqrt((x1 - x[-1]) ** 2.0 + (y1 - y[-1]) ** 2.0 + (z1 - z[-1]) ** 2.0)</span>
<span class="sd">                r2 = np.sqrt((x2 - x[-1]) ** 2.0 + (y2 - y[-1]) ** 2.0 + (z2 - z[-1]) ** 2.0)</span>
<span class="sd">                &#39;&#39;&#39;</span>
                <span class="n">mb</span><span class="o">=</span><span class="p">(</span><span class="n">m1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">m2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

                <span class="n">semi</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mf">2.</span><span class="o">*</span><span class="n">mb</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">))</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">out34</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="k">while</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">999</span><span class="p">:</span>
        <span class="c1"># IGNORE GHOST PARTICLES</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">ns</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">ntot</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i_d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
            <span class="n">kw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">m</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">logl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">logr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="o">+</span> <span class="n">xc</span><span class="p">)</span>
            <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">+</span> <span class="n">yc</span><span class="p">)</span>
            <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span> <span class="o">+</span> <span class="n">zc</span><span class="p">)</span>
            <span class="n">vx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
            <span class="n">vy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>
            <span class="n">vz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">:</span>
                <span class="n">kin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">]))</span>
                <span class="n">pot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">]))</span>
                <span class="n">etot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">15</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="n">pot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="n">etot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

            <span class="n">nsbnd</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">out34</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="n">nbnd</span> <span class="o">=</span> <span class="n">nsbnd</span> <span class="o">+</span> <span class="n">nbbnd</span>

    <span class="n">cluster</span> <span class="o">=</span> <span class="n">StarCluster</span><span class="p">(</span>
        <span class="n">nsbnd</span><span class="p">,</span>
        <span class="n">tphys</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;nbody&quot;</span><span class="p">,</span>
        <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span>
        <span class="n">ctype</span><span class="o">=</span><span class="s2">&quot;nbody6&quot;</span><span class="p">,</span>
        <span class="n">sfile</span><span class="o">=</span><span class="n">out34</span><span class="p">,</span>
        <span class="n">bfile</span><span class="o">=</span><span class="n">out9</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">add_nbody6</span><span class="p">(</span>
        <span class="n">nc</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">rbar</span><span class="p">,</span> <span class="n">rtide</span><span class="p">,</span> <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">zc</span><span class="p">,</span> <span class="n">zmbar</span><span class="p">,</span> <span class="n">vstar</span><span class="p">,</span> <span class="n">rscale</span><span class="p">,</span> <span class="n">nsbnd</span><span class="p">,</span> <span class="n">nbbnd</span><span class="p">,</span> <span class="n">n_p</span>
    <span class="p">)</span>
    <span class="c1"># Add back on the centre of mass which has been substracted off by NBODY6</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">add_stars</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">i_d</span><span class="p">)</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">add_sse</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="n">logl</span><span class="p">,</span> <span class="n">logr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbnd</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbnd</span><span class="p">))</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">add_energies</span><span class="p">(</span><span class="n">kin</span><span class="p">,</span> <span class="n">pot</span><span class="p">,</span> <span class="n">etot</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">out9</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">add_bse</span><span class="p">(</span>
            <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">kw1</span><span class="p">,</span> <span class="n">kw2</span><span class="p">,</span> <span class="n">kcm</span><span class="p">,</span> <span class="n">ecc</span><span class="p">,</span> <span class="n">pb</span><span class="p">,</span> <span class="n">semi</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">logl1</span><span class="p">,</span> <span class="n">logl2</span><span class="p">,</span> <span class="n">logr1</span><span class="p">,</span> <span class="n">logr2</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;do_key_params&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
        <span class="n">do_order</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;do_key_params&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Estimate centre of distribution</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">find_centre</span><span class="p">()</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_centre</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_cluster</span><span class="p">()</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">add_orbit</span><span class="p">(</span><span class="n">xgc</span><span class="p">,</span> <span class="n">ygc</span><span class="p">,</span> <span class="n">zgc</span><span class="p">,</span> <span class="n">vxgc</span><span class="p">,</span> <span class="n">vygc</span><span class="p">,</span> <span class="n">vzgc</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cluster</span>

<span class="k">def</span> <span class="nf">get_snapshot</span><span class="p">(</span>
    <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">tphys</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">ctype</span><span class="o">=</span><span class="s2">&quot;snapshot&quot;</span><span class="p">,</span>
    <span class="n">col_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="s2">&quot;vx&quot;</span><span class="p">,</span> <span class="s2">&quot;vy&quot;</span><span class="p">,</span> <span class="s2">&quot;vz&quot;</span><span class="p">],</span>
    <span class="n">col_nums</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
    <span class="n">units</span><span class="o">=</span><span class="s2">&quot;pckms&quot;</span><span class="p">,</span>
    <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span>
    <span class="n">ofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">advance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       get_snapshot</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Load a generic snapshot where column names and numbers can be manually assigned</span>

<span class="sd">    INPUT:</span>

<span class="sd">       ctype - code used to generate data (nbody6/nbody6se/gyrfalcon/...)</span>

<span class="sd">       filename - name of file</span>

<span class="sd">       col_names - names corresponding to mass, position, and velocity</span>

<span class="sd">       col_nums - column numbers corresponding to each column name</span>

<span class="sd">       units - units of input data (default: kpckms)</span>

<span class="sd">       origin - origin of input data (default: cluster)</span>

<span class="sd">       ofile - opened file containing orbital information</span>

<span class="sd">       advance - is this a snapshot that has been advanced to from initial load_cluster?</span>

<span class="sd">       </span>
<span class="sd">    KWARGS:</span>

<span class="sd">        same as load_cluster</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       StarCluster instance</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">col_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">col_names</span><span class="p">)</span>
    <span class="n">col_nums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">col_nums</span><span class="p">)</span>

    <span class="n">nsnap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nsnap&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span>
    <span class="n">nzfill</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nzfill&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">delimiter</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;delimiter&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">wdir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;wdir&quot;</span><span class="p">,</span> <span class="s2">&quot;./&quot;</span><span class="p">)</span>
    <span class="n">snapdir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;snapdir&quot;</span><span class="p">,</span> <span class="s2">&quot;snaps/&quot;</span><span class="p">)</span>
    <span class="n">snapbase</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;snapbase&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">snapend</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;snapend&quot;</span><span class="p">,</span> <span class="s2">&quot;.dat&quot;</span><span class="p">)</span>
    <span class="n">skiprows</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;skiprows&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;WDunits&quot;</span><span class="p">:</span>
        <span class="n">vcon</span> <span class="o">=</span> <span class="mf">220.0</span> <span class="o">/</span> <span class="n">bovy_conversion</span><span class="o">.</span><span class="n">velocity_in_kpcGyr</span><span class="p">(</span><span class="mf">220.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">)</span>
        <span class="n">mcon</span> <span class="o">=</span> <span class="mf">222288.4543021174</span>
        <span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;kpckms&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vcon</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">mcon</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wdir</span><span class="p">,</span> <span class="n">snapdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wdir</span><span class="p">,</span> <span class="n">snapdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span>
                <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
                <span class="n">skiprows</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="n">skiprows</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NO FILE FOUND: </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wdir</span><span class="p">,</span> <span class="n">snapdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
            <span class="n">cluster</span> <span class="o">=</span> <span class="n">StarCluster</span><span class="p">(</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ctype</span><span class="o">=</span><span class="n">ctype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ntot</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cluster</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s%s%s%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wdir</span><span class="p">,</span> <span class="n">snapdir</span><span class="p">,</span> <span class="n">snapbase</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nsnap</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">nzfill</span><span class="p">),</span> <span class="n">snapend</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s%s%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">wdir</span><span class="p">,</span>
            <span class="n">snapdir</span><span class="p">,</span>
            <span class="n">snapbase</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">nsnap</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">nzfill</span><span class="p">),</span>
            <span class="n">snapend</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s%s%s%s%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">wdir</span><span class="p">,</span> <span class="n">snapdir</span><span class="p">,</span> <span class="n">snapbase</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nsnap</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">nzfill</span><span class="p">),</span> <span class="n">snapend</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
            <span class="n">skiprows</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s%s%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wdir</span><span class="p">,</span> <span class="n">snapbase</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nsnap</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">nzfill</span><span class="p">),</span> <span class="n">snapend</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wdir</span><span class="p">,</span> <span class="n">snapbase</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nsnap</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">nzfill</span><span class="p">),</span> <span class="n">snapend</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wdir</span><span class="p">,</span> <span class="n">snapbase</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nsnap</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">nzfill</span><span class="p">),</span> <span class="n">snapend</span><span class="p">)),</span>
            <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
            <span class="n">skiprows</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;NO FILE FOUND - </span><span class="si">%s%s%s%s%s</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">wdir</span><span class="p">,</span> <span class="n">snapdir</span><span class="p">,</span> <span class="n">snapbase</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">nsnap</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">nzfill</span><span class="p">),</span> <span class="n">snapend</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s%s%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">wdir</span><span class="p">,</span>
            <span class="n">snapdir</span><span class="p">,</span>
            <span class="n">snapbase</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">nsnap</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="n">nzfill</span><span class="p">),</span>
            <span class="n">snapend</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">cluster</span> <span class="o">=</span> <span class="n">StarCluster</span><span class="p">(</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ctype</span><span class="o">=</span><span class="n">ctype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ntot</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cluster</span>

    <span class="n">mindx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">col_names</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">col_nums</span><span class="p">[</span><span class="n">mindx</span><span class="p">]]</span> <span class="o">*</span> <span class="n">mcon</span>

    <span class="n">xindx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">col_names</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">col_nums</span><span class="p">[</span><span class="n">xindx</span><span class="p">]]</span>
    <span class="n">yindx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">col_names</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">col_nums</span><span class="p">[</span><span class="n">yindx</span><span class="p">]]</span>
    <span class="n">zindx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">col_names</span> <span class="o">==</span> <span class="s2">&quot;z&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">col_nums</span><span class="p">[</span><span class="n">zindx</span><span class="p">]]</span>
    <span class="n">vxindx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">col_names</span> <span class="o">==</span> <span class="s2">&quot;vx&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">col_nums</span><span class="p">[</span><span class="n">vxindx</span><span class="p">]]</span> <span class="o">*</span> <span class="n">vcon</span>
    <span class="n">vyindx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">col_names</span> <span class="o">==</span> <span class="s2">&quot;vy&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">col_nums</span><span class="p">[</span><span class="n">vyindx</span><span class="p">]]</span> <span class="o">*</span> <span class="n">vcon</span>
    <span class="n">vzindx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">col_names</span> <span class="o">==</span> <span class="s2">&quot;vz&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">col_nums</span><span class="p">[</span><span class="n">vzindx</span><span class="p">]]</span> <span class="o">*</span> <span class="n">vcon</span>

    <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">col_names</span><span class="p">:</span>
        <span class="n">idindx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">col_names</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">i_d</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">col_nums</span><span class="p">[</span><span class="n">idindx</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">i_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="s2">&quot;kw&quot;</span> <span class="ow">in</span> <span class="n">col_names</span><span class="p">:</span>
        <span class="n">kwindx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">col_names</span> <span class="o">==</span> <span class="s2">&quot;kw&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">col_nums</span><span class="p">[</span><span class="n">kwindx</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="n">nbnd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="n">cluster</span> <span class="o">=</span> <span class="n">StarCluster</span><span class="p">(</span>
        <span class="n">nbnd</span><span class="p">,</span> <span class="n">tphys</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">ctype</span><span class="o">=</span><span class="n">ctype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">add_stars</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">i_d</span><span class="p">)</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">kw</span> <span class="o">=</span> <span class="n">kw</span>

    <span class="k">if</span> <span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;galaxy&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ofile</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">find_centre</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get_cluster_orbit</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="n">advance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;do_key_params&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">do_order</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;do_key_params&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

            <span class="n">cluster</span><span class="o">.</span><span class="n">to_cluster</span><span class="p">()</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">find_centre</span><span class="p">()</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_centre</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">)</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_galaxy</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;cluster&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;do_key_params&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">do_order</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;do_key_params&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Estimate centre of distribution</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">find_centre</span><span class="p">()</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_centre</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">)</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_cluster</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ofile</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">get_cluster_orbit</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="n">advance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cluster</span>

<span class="k">def</span> <span class="nf">get_amuse_particles</span><span class="p">(</span>
    <span class="n">particles</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kpckms&quot;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;galaxy&quot;</span><span class="p">,</span> <span class="n">ofile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       get_amuse_particles</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Convert AMUSE particle dataset to a StarCluster instance</span>

<span class="sd">    INPUT:</span>

<span class="sd">       particles - AMUSE particle dataset</span>

<span class="sd">       units - units of input data (default: kpckms)</span>

<span class="sd">       origin - origin of input data (default: cluster)</span>
<span class="sd">       </span>
<span class="sd">    KWARGS:</span>

<span class="sd">        same as load_cluster</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       StarCluster instance</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cluster</span> <span class="o">=</span> <span class="n">StarCluster</span><span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">particles</span><span class="p">),</span>
        <span class="n">tphys</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span>
        <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span>
        <span class="n">ctype</span><span class="o">=</span><span class="s2">&quot;amuse&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="n">i_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">particles</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">particles</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">mass</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">MSun</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;pckms&quot;</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">parsec</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">parsec</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">parsec</span><span class="p">)</span>
        <span class="n">vx</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">vx</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kms</span><span class="p">)</span>
        <span class="n">vy</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">vy</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kms</span><span class="p">)</span>
        <span class="n">vz</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">vz</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kms</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;kpckms&quot;</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">z</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kpc</span><span class="p">)</span>
        <span class="n">vx</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">vx</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kms</span><span class="p">)</span>
        <span class="n">vy</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">vy</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kms</span><span class="p">)</span>
        <span class="n">vz</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">vz</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">kms</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PLEASE SPECIFY UNITS&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">add_stars</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">i_d</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;galaxy&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ofile</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">find_centre</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get_cluster_orbit</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="n">advance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;do_key_params&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">do_order</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;do_key_params&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_cluster</span><span class="p">()</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">find_centre</span><span class="p">()</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_centre</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">)</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_galaxy</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;cluster&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;do_key_params&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">do_order</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;do_key_params&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Estimate centre of distribution</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">find_centre</span><span class="p">()</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_centre</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">)</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_cluster</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ofile</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">get_cluster_orbit</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">ofile</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="n">advance</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cluster</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">clustertools 0.1.dev1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Jeremy J. Webb.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>