
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>clustertools.analysis.operations &#8212; clustertools 0.1.dev1 documentation</title>
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="shortcut icon" href="../../../_static/astropy_logo.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">clustertools 0.1.dev1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for clustertools.analysis.operations</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot; Perform an operation on a cluster and return a new cluster</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Jeremy J Webb&quot;</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;find_centre&quot;</span><span class="p">,</span>
    <span class="s2">&quot;find_centre_of_density&quot;</span><span class="p">,</span>
    <span class="s2">&quot;find_centre_of_mass&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_pckms&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_kpckms&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_nbody&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_radec&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_galpy&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_units&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_centre&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_cluster&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_galaxy&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_sky&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_tail&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_origin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;save_cluster&quot;</span><span class="p">,</span>
    <span class="s2">&quot;return_cluster&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rotate_to_tail&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reset_nbody_scale&quot;</span><span class="p">,</span>
    <span class="s2">&quot;convert_binary_units&quot;</span><span class="p">,</span>
    <span class="s2">&quot;add_rotation&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">..util.recipes</span> <span class="kn">import</span> <span class="n">rotate</span>
<span class="kn">from</span> <span class="nn">galpy.util</span> <span class="kn">import</span> <span class="n">bovy_conversion</span>


<div class="viewcode-block" id="find_centre"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.find_centre">[docs]</a><span class="k">def</span> <span class="nf">find_centre</span><span class="p">(</span>
    <span class="n">cluster</span><span class="p">,</span>
    <span class="n">xstart</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">ystart</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">zstart</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">vxstart</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">vystart</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">vzstart</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">indx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nsigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">nsphere</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">rmin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">nmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">ro</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
    <span class="n">vo</span><span class="o">=</span><span class="mf">220.0</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       find_centre</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Find the centre of mass of the cluster</span>
<span class="sd">       Notes:</span>
<span class="sd">        - The routine first works to identify a sphere of nsphere stars around the centre in which</span>
<span class="sd">        to perform the C.O.M calculation. This step prevents long tidal tails from affecting the </span>
<span class="sd">        calculation</span>

<span class="sd">    INPUT:</span>
<span class="sd">       xstart,ystart,zstart - starting position for centre</span>
<span class="sd">       vxstart,vystart,vzstart - starting velocity for centre</span>
<span class="sd">       indx - subset of stars to use when finding center</span>
<span class="sd">       nsigma - number of standard deviations to within which to keep stars</span>
<span class="sd">       nsphere - number of stars in centre sphere (default:100)</span>
<span class="sd">       density - use Yohai Meiron&#39;s centre of density calculator instead (Default: True)</span>
<span class="sd">       if density:</span>
<span class="sd">           - rmin - minimum radius to start looking for stars</span>
<span class="sd">           - nmax - maximum number of iterations to find centre</span>
<span class="sd">       ro,vo - For converting to and from galpy units (Default: 8., 220.)</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       xc,yc,zc,vxc,vyc,vzc - coordinates of centre of mass</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2019 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">indx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ntot</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NO SUBSET OF STARS GIVEN&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>

    <span class="k">if</span> <span class="n">density</span><span class="p">:</span>
        <span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">zc</span><span class="p">,</span><span class="n">vxc</span><span class="p">,</span><span class="n">vyc</span><span class="p">,</span><span class="n">vzc</span><span class="o">=</span><span class="n">find_centre_of_density</span><span class="p">(</span>
            <span class="n">cluster</span><span class="o">=</span><span class="n">cluster</span><span class="p">,</span>
            <span class="n">xstart</span><span class="o">=</span><span class="n">xstart</span><span class="p">,</span>
            <span class="n">ystart</span><span class="o">=</span><span class="n">ystart</span><span class="p">,</span>
            <span class="n">zstart</span><span class="o">=</span><span class="n">zstart</span><span class="p">,</span>
            <span class="n">vxstart</span><span class="o">=</span><span class="n">vxstart</span><span class="p">,</span>
            <span class="n">vystart</span><span class="o">=</span><span class="n">vystart</span><span class="p">,</span>
            <span class="n">vzstart</span><span class="o">=</span><span class="n">vzstart</span><span class="p">,</span>
            <span class="n">indx</span><span class="o">=</span><span class="n">indx</span><span class="p">,</span>
            <span class="n">rmin</span><span class="o">=</span><span class="n">rmin</span><span class="p">,</span>
            <span class="n">nmax</span><span class="o">=</span><span class="n">nmax</span><span class="p">,</span>
            <span class="n">ro</span><span class="o">=</span><span class="n">ro</span><span class="p">,</span>
            <span class="n">vo</span><span class="o">=</span><span class="n">vo</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">-</span> <span class="n">xstart</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">-</span> <span class="n">ystart</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">-</span> <span class="n">zstart</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">y</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">z</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">i_d</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">nsphere</span><span class="p">:</span>
            <span class="n">sigma</span> <span class="o">=</span> <span class="n">nsigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="n">indx</span> <span class="o">=</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">sigma</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">nsphere</span><span class="p">:</span>
                <span class="n">i_d</span> <span class="o">=</span> <span class="n">i_d</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Find centre of mass and velocity of inner stars:</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">i_d</span><span class="p">)</span>

        <span class="n">xc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span>
        <span class="n">yc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span>
        <span class="n">zc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span>

        <span class="n">vxc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span>
        <span class="n">vyc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span>
        <span class="n">vzc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">zc</span><span class="p">,</span> <span class="n">vxc</span><span class="p">,</span> <span class="n">vyc</span><span class="p">,</span> <span class="n">vzc</span></div>

<div class="viewcode-block" id="find_centre_of_density"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.find_centre_of_density">[docs]</a><span class="k">def</span> <span class="nf">find_centre_of_density</span><span class="p">(</span>
    <span class="n">cluster</span><span class="p">,</span>
    <span class="n">xstart</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">ystart</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">zstart</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">vxstart</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">vystart</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">vzstart</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">indx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rmin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">nmax</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">ro</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
    <span class="n">vo</span><span class="o">=</span><span class="mf">220.0</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       find_centre_of_density</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Find the centre of density of the cluster</span>
<span class="sd">       Notes - the general framework for this code was taken from Yohai Meiron,</span>
<span class="sd">       who made a python adaptation of the centre of density finder in PhiGrape</span>

<span class="sd">    INPUT:</span>
<span class="sd">       xstart,ystart,zstart - starting position for centre</span>
<span class="sd">       vxstart,vystart,vzstart - starting velocity for centre</span>
<span class="sd">       rmin - minimum radius of sphere around which to estimate density centre (default: 0.1 pc)</span>
<span class="sd">       nmax - maximum number of iterations (default:100)</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       xc,yc,zc,vxc,vyc,vzc - coordinates of centre of mass</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2019 - Written - Webb (UofT)</span>
<span class="sd">       - with kudos to Yohai Meiron (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Need to change rmin for pc to cluster.units:</span>
    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">!=</span> <span class="s2">&quot;nbody&quot;</span><span class="p">:</span>
        <span class="n">rmin</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
    <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;kpckms&quot;</span><span class="p">:</span>
        <span class="n">rmin</span> <span class="o">/=</span> <span class="mf">1000.0</span>
    <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;galpy&quot;</span><span class="p">:</span>
        <span class="n">rmin</span> <span class="o">/=</span> <span class="mf">1000.0</span> <span class="o">*</span> <span class="n">ro</span>

    <span class="k">if</span> <span class="n">indx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ntot</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">-</span> <span class="n">xstart</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">-</span> <span class="n">ystart</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">-</span> <span class="n">zstart</span>
    <span class="n">vx</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">-</span> <span class="n">vxstart</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">-</span> <span class="n">vystart</span>
    <span class="n">vz</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">-</span> <span class="n">vzstart</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">y</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">z</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>
    <span class="n">rlim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

    <span class="n">xdc</span><span class="p">,</span> <span class="n">ydc</span><span class="p">,</span> <span class="n">zdc</span> <span class="o">=</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">ystart</span><span class="p">,</span> <span class="n">zstart</span>
    <span class="n">vxdc</span><span class="p">,</span> <span class="n">vydc</span><span class="p">,</span> <span class="n">vzdc</span> <span class="o">=</span> <span class="n">vxstart</span><span class="p">,</span> <span class="n">vystart</span><span class="p">,</span> <span class="n">vzstart</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">rlim</span> <span class="o">&gt;</span> <span class="n">rmin</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">nmax</span><span class="p">):</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">y</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">z</span> <span class="o">**</span> <span class="mf">2.0</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="n">r2</span> <span class="o">&lt;</span> <span class="n">rlim</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span>
        <span class="n">mc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">mc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">,</span> <span class="n">zc</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
            <span class="n">vxc</span><span class="p">,</span> <span class="n">vyc</span><span class="p">,</span> <span class="n">vzc</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">xc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span> <span class="o">/</span> <span class="n">mc</span>
            <span class="n">yc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span> <span class="o">/</span> <span class="n">mc</span>
            <span class="n">zc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">*</span> <span class="n">z</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span> <span class="o">/</span> <span class="n">mc</span>

            <span class="n">vxc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">*</span> <span class="n">vx</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span> <span class="o">/</span> <span class="n">mc</span>
            <span class="n">vyc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">*</span> <span class="n">vy</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span> <span class="o">/</span> <span class="n">mc</span>
            <span class="n">vzc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">*</span> <span class="n">vz</span><span class="p">[</span><span class="n">indx</span><span class="p">])</span> <span class="o">/</span> <span class="n">mc</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">mc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">nc</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">-=</span> <span class="n">xc</span>
            <span class="n">y</span> <span class="o">-=</span> <span class="n">yc</span>
            <span class="n">z</span> <span class="o">-=</span> <span class="n">zc</span>
            <span class="n">xdc</span> <span class="o">+=</span> <span class="n">xc</span>
            <span class="n">ydc</span> <span class="o">+=</span> <span class="n">yc</span>
            <span class="n">zdc</span> <span class="o">+=</span> <span class="n">zc</span>

            <span class="n">vx</span> <span class="o">-=</span> <span class="n">vxc</span>
            <span class="n">vy</span> <span class="o">-=</span> <span class="n">vyc</span>
            <span class="n">vz</span> <span class="o">-=</span> <span class="n">vzc</span>
            <span class="n">vxdc</span> <span class="o">+=</span> <span class="n">vxc</span>
            <span class="n">vydc</span> <span class="o">+=</span> <span class="n">vyc</span>
            <span class="n">vzdc</span> <span class="o">+=</span> <span class="n">vzc</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">rlim</span> <span class="o">*=</span> <span class="mf">0.8</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">xdc</span><span class="p">,</span> <span class="n">ydc</span><span class="p">,</span> <span class="n">zdc</span><span class="p">,</span><span class="n">vxdc</span><span class="p">,</span> <span class="n">vydc</span><span class="p">,</span> <span class="n">vzdc</span></div>


<div class="viewcode-block" id="find_centre_of_mass"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.find_centre_of_mass">[docs]</a><span class="k">def</span> <span class="nf">find_centre_of_mass</span><span class="p">(</span><span class="n">cluster</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       find_centre_of_mass</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Find the centre of mass of the cluster</span>

<span class="sd">    INPUT:</span>
<span class="sd">       None</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       xc,yc,zc,vxc,vyc,vzc - coordinates of centre of mass</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">mtot</span>
    <span class="n">yc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">mtot</span>
    <span class="n">zc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">z</span><span class="p">)</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">mtot</span>

    <span class="n">vxc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span><span class="p">)</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">mtot</span>
    <span class="n">vyc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span><span class="p">)</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">mtot</span>
    <span class="n">vzc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span><span class="p">)</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">mtot</span>

    <span class="k">return</span> <span class="n">xdc</span><span class="p">,</span> <span class="n">ydc</span><span class="p">,</span> <span class="n">zdc</span><span class="p">,</span><span class="n">vxdc</span><span class="p">,</span> <span class="n">vydc</span><span class="p">,</span> <span class="n">vzdc</span></div>

<div class="viewcode-block" id="to_pckms"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.to_pckms">[docs]</a><span class="k">def</span> <span class="nf">to_pckms</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       to_pckms</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Convert stellar positions/velocities, centre of mass, and orbital position and velocity to pc and km/s</span>

<span class="sd">    INPUT:</span>

<span class="sd">       None</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">        None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;galpy&quot;</span> <span class="ow">or</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;radec&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_kpckms</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;nbody&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">zmbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">yc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vxc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vyc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vzc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xgc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zgc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vxgc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vygc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vzgc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;pckms&quot;</span>

        <span class="c1">#if cluster.nb &gt; 0:</span>
        <span class="c1">#    yrs = (cluster.rbar * 1296000.0 / (2.0 * np.pi)) ** 1.5 / np.sqrt(</span>
        <span class="c1">#        cluster.zmbar</span>
        <span class="c1">#    )</span>
        <span class="c1">#    days = 365.25 * yrs</span>
        <span class="c1">#    pctoau = 206265.0</span>

        <span class="c1">#    cluster.pb *= days</span>
        <span class="c1">#    cluster.semi *= cluster.rbar * pctoau</span>

    <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;kpckms&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">*=</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">*=</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">*=</span> <span class="mf">1000.0</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xgc</span> <span class="o">*=</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span> <span class="o">*=</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zgc</span> <span class="o">*=</span> <span class="mf">1000.0</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xc</span> <span class="o">*=</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">yc</span> <span class="o">*=</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zc</span> <span class="o">*=</span> <span class="mf">1000.0</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;pckms&quot;</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">rv3d</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">do_key_params</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">key_params</span><span class="p">()</span></div>

<div class="viewcode-block" id="to_kpckms"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.to_kpckms">[docs]</a><span class="k">def</span> <span class="nf">to_kpckms</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ro</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">vo</span><span class="o">=</span><span class="mf">220.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       to_kpckms</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Convert stellar positions/velocities, centre of mass, and orbital position and velocity to kpc and km/s</span>

<span class="sd">    INPUT:</span>

<span class="sd">       None</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">        None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;radec&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">from_radec</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;galpy&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">*=</span> <span class="n">bovy_conversion</span><span class="o">.</span><span class="n">mass_in_msol</span><span class="p">(</span><span class="n">ro</span><span class="o">=</span><span class="n">ro</span><span class="p">,</span> <span class="n">vo</span><span class="o">=</span><span class="n">vo</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">*=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">*=</span> <span class="n">vo</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">*=</span> <span class="n">vo</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">*=</span> <span class="n">vo</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xc</span> <span class="o">*=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">yc</span> <span class="o">*=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zc</span> <span class="o">*=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vxc</span> <span class="o">*=</span> <span class="n">vo</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vyc</span> <span class="o">*=</span> <span class="n">vo</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vzc</span> <span class="o">*=</span> <span class="n">vo</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xgc</span> <span class="o">*=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span> <span class="o">*=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zgc</span> <span class="o">*=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vxgc</span> <span class="o">*=</span> <span class="n">vo</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vygc</span> <span class="o">*=</span> <span class="n">vo</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vzgc</span> <span class="o">*=</span> <span class="n">vo</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;kpckms&quot;</span>

    <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;nbody&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">zmbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span> <span class="o">/</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span> <span class="o">/</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span> <span class="o">/</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span> <span class="o">/</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">yc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span> <span class="o">/</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span> <span class="o">/</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vxc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vyc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vzc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xgc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span> <span class="o">/</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span> <span class="o">/</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zgc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span> <span class="o">/</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vxgc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vygc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vzgc</span> <span class="o">*=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;kpckms&quot;</span>

    <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;pckms&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">/=</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">/=</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">/=</span> <span class="mf">1000.0</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xgc</span> <span class="o">/=</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span> <span class="o">/=</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zgc</span> <span class="o">/=</span> <span class="mf">1000.0</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xc</span> <span class="o">/=</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">yc</span> <span class="o">/=</span> <span class="mf">1000.0</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zc</span> <span class="o">/=</span> <span class="mf">1000.0</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;kpckms&quot;</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">rv3d</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">do_key_params</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">key_params</span><span class="p">()</span></div>

<div class="viewcode-block" id="to_nbody"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.to_nbody">[docs]</a><span class="k">def</span> <span class="nf">to_nbody</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ro</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">vo</span><span class="o">=</span><span class="mf">220.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       to_nbody</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Convert stellar positions/velocities, centre of mass, and orbital position and velocity to Nbody units</span>
<span class="sd">       Notes:</span>
<span class="sd">        - requires that cluster.zmbar, cluster.rbar, cluster.vstar are set (defaults are 1 in add_nbody6)</span>

<span class="sd">    INPUT:</span>

<span class="sd">       None</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">        None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">!=</span> <span class="s2">&quot;pckms&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_pckms</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;pckms&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">zmbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xc</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">yc</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zc</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vxc</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vyc</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vzc</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xgc</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zgc</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vxgc</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vygc</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vzgc</span> <span class="o">/=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;nbody&quot;</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">rv3d</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">do_key_params</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">key_params</span><span class="p">()</span></div>

<div class="viewcode-block" id="to_radec"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.to_radec">[docs]</a><span class="k">def</span> <span class="nf">to_radec</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ro</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">vo</span><span class="o">=</span><span class="mf">220.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       to_radec</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Convert to on-sky position, proper motion, and radial velocity of cluster</span>

<span class="sd">    INPUT:</span>

<span class="sd">       None</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">        ra,dec,dist,pmra,pmdec,vlos</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2019 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ra</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">pmra</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">pmdec</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">vlos</span><span class="p">)</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;radec&quot;</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;sky&quot;</span>

    <span class="k">except</span><span class="p">:</span>

        <span class="n">units0</span><span class="p">,</span> <span class="n">origin0</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">to_galaxy</span><span class="p">()</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_kpckms</span><span class="p">()</span>

        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">galcenrect_to_XYZ</span><span class="p">(</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">Xsun</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">Zsun</span><span class="o">=</span><span class="mf">0.025</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x0</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">y0</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">z0</span> <span class="o">**</span> <span class="mf">2.0</span><span class="p">)</span>

        <span class="n">vx0</span><span class="p">,</span> <span class="n">vy0</span><span class="p">,</span> <span class="n">vz0</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">galcenrect_to_vxvyvz</span><span class="p">(</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span><span class="p">,</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span><span class="p">,</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span><span class="p">,</span>
            <span class="n">Xsun</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
            <span class="n">Zsun</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span>
            <span class="n">vsun</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">11.1</span><span class="p">,</span> <span class="mf">244.0</span><span class="p">,</span> <span class="mf">7.25</span><span class="p">],</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">vlos</span> <span class="o">=</span> <span class="p">(</span><span class="n">vx0</span> <span class="o">*</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">vy0</span> <span class="o">*</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">vz0</span> <span class="o">*</span> <span class="n">z0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="n">x0</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">y0</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">z0</span> <span class="o">**</span> <span class="mf">2.0</span>
        <span class="p">)</span>

        <span class="n">l0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">XYZ_to_lbd</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">dec</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">lb_to_radec</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">vr0</span><span class="p">,</span> <span class="n">pmll0</span><span class="p">,</span> <span class="n">pmbb0</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">vxvyvz_to_vrpmllpmbb</span><span class="p">(</span>
            <span class="n">vx0</span><span class="p">,</span> <span class="n">vy0</span><span class="p">,</span> <span class="n">vz0</span><span class="p">,</span> <span class="n">l0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">dist</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">pmra</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">pmdec</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">pmllpmbb_to_pmrapmdec</span><span class="p">(</span>
            <span class="n">pmll0</span><span class="p">,</span> <span class="n">pmbb0</span><span class="p">,</span> <span class="n">l0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">galcenrect_to_XYZ</span><span class="p">(</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">xgc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">zgc</span><span class="p">,</span> <span class="n">Xsun</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">Zsun</span><span class="o">=</span><span class="mf">0.025</span>
        <span class="p">)</span>
        <span class="n">vx0</span><span class="p">,</span> <span class="n">vy0</span><span class="p">,</span> <span class="n">vz0</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">galcenrect_to_vxvyvz</span><span class="p">(</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">vxgc</span><span class="p">,</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">vygc</span><span class="p">,</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">vzgc</span><span class="p">,</span>
            <span class="n">Xsun</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
            <span class="n">Zsun</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span>
            <span class="n">vsun</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">11.1</span><span class="p">,</span> <span class="mf">244.0</span><span class="p">,</span> <span class="mf">7.25</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">vlos_gc</span> <span class="o">=</span> <span class="p">(</span><span class="n">vx0</span> <span class="o">*</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">vy0</span> <span class="o">*</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">vz0</span> <span class="o">*</span> <span class="n">z0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="n">x0</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">y0</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">z0</span> <span class="o">**</span> <span class="mf">2.0</span>
        <span class="p">)</span>

        <span class="n">l0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">dist_gc</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">XYZ_to_lbd</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">ra_gc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">dec_gc</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">lb_to_radec</span><span class="p">(</span><span class="n">l0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">vr0</span><span class="p">,</span> <span class="n">pmll0</span><span class="p">,</span> <span class="n">pmbb0</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">vxvyvz_to_vrpmllpmbb</span><span class="p">(</span>
            <span class="n">vx0</span><span class="p">,</span> <span class="n">vy0</span><span class="p">,</span> <span class="n">vz0</span><span class="p">,</span> <span class="n">l0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">dist_gc</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">pmra_gc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">pmdec_gc</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">pmllpmbb_to_pmrapmdec</span><span class="p">(</span>
            <span class="n">pmll0</span><span class="p">,</span> <span class="n">pmbb0</span><span class="p">,</span> <span class="n">l0</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ra</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">dec</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">pmra</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">pmdec</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">vlos</span><span class="p">)</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xgc</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ra_gc</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">dec_gc</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zgc</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">dist_gc</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vxgc</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">pmra_gc</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vygc</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">pmdec_gc</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vzgc</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">vlos_gc</span><span class="p">)</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;radec&quot;</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;sky&quot;</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">rv3d</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">do_key_params</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">key_params</span><span class="p">(</span><span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">from_radec</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       from_radec</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Calculate galactocentric coordinates from on-sky position, proper motion, and radial velocity of cluster</span>

<span class="sd">    INPUT:</span>

<span class="sd">       None</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">        x,y,z,vx,vy,vz</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2019 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;radec&quot;</span> <span class="ow">and</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;sky&quot;</span><span class="p">:</span>

        <span class="n">origin0</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span>

        <span class="n">l</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">radec_to_lb</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">lbd_to_XYZ</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">dist</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">XYZ_to_galcenrect</span><span class="p">(</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">Xsun</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">Zsun</span><span class="o">=</span><span class="mf">0.025</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">pml</span><span class="p">,</span> <span class="n">pmb</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">pmrapmdec_to_pmllpmbb</span><span class="p">(</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">pmra</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">pmdec</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">vx0</span><span class="p">,</span> <span class="n">vy0</span><span class="p">,</span> <span class="n">vz0</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">vrpmllpmbb_to_vxvyvz</span><span class="p">(</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">vlos</span><span class="p">,</span> <span class="n">pml</span><span class="p">,</span> <span class="n">pmb</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">dist</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">vxvyvz_to_galcenrect</span><span class="p">(</span>
            <span class="n">vx0</span><span class="p">,</span>
            <span class="n">vy0</span><span class="p">,</span>
            <span class="n">vz0</span><span class="p">,</span>
            <span class="n">vsun</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">220.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
            <span class="n">Xsun</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
            <span class="n">Zsun</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span>
            <span class="n">_extra_rot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">l_gc</span><span class="p">,</span> <span class="n">b_gc</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">radec_to_lb</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ra_gc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">dec_gc</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">x0_gc</span><span class="p">,</span> <span class="n">y0_gc</span><span class="p">,</span> <span class="n">z0_gc</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">lbd_to_XYZ</span><span class="p">(</span>
            <span class="n">l_gc</span><span class="p">,</span> <span class="n">b_gc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">dist_gc</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">xgc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">zgc</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">XYZ_to_galcenrect</span><span class="p">(</span>
            <span class="n">x0_gc</span><span class="p">,</span> <span class="n">y0_gc</span><span class="p">,</span> <span class="n">z0_gc</span><span class="p">,</span> <span class="n">Xsun</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">Zsun</span><span class="o">=</span><span class="mf">0.025</span>
        <span class="p">)</span>

        <span class="n">pml_gc</span><span class="p">,</span> <span class="n">pmb_gc</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">pmrapmdec_to_pmllpmbb</span><span class="p">(</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">pmra_gc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">pmdec_gc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">ra_gc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">dec_gc</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">vx0_gc</span><span class="p">,</span> <span class="n">vy0_gc</span><span class="p">,</span> <span class="n">vz0_gc</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">vrpmllpmbb_to_vxvyvz</span><span class="p">(</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">vlos_gc</span><span class="p">,</span> <span class="n">pml_gc</span><span class="p">,</span> <span class="n">pmb_gc</span><span class="p">,</span> <span class="n">l_gc</span><span class="p">,</span> <span class="n">b_gc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">dist_gc</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx_gc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vy_gc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vz_gc</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">vxvyvz_to_galcenrect</span><span class="p">(</span>
            <span class="n">vx0_gc</span><span class="p">,</span>
            <span class="n">vy0_gc</span><span class="p">,</span>
            <span class="n">vz0_gc</span><span class="p">,</span>
            <span class="n">vsun</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">220.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
            <span class="n">Xsun</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span>
            <span class="n">Zsun</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span>
            <span class="n">_extra_rot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;galaxy&quot;</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;kpckms&quot;</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">rv3d</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">do_key_params</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">key_params</span><span class="p">(</span><span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">)</span>

<div class="viewcode-block" id="to_galpy"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.to_galpy">[docs]</a><span class="k">def</span> <span class="nf">to_galpy</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ro</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">vo</span><span class="o">=</span><span class="mf">220.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       to_galpy</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Convert stellar positions/velocities, centre of mass, and orbital position and velocity to galpy units</span>

<span class="sd">    INPUT:</span>

<span class="sd">       None</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">!=</span> <span class="s2">&quot;kpckms&quot;</span> <span class="ow">and</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">!=</span> <span class="s2">&quot;galpy&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_kpckms</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;kpckms&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">m</span> <span class="o">/</span> <span class="n">bovy_conversion</span><span class="o">.</span><span class="n">mass_in_msol</span><span class="p">(</span><span class="n">ro</span><span class="o">=</span><span class="n">ro</span><span class="p">,</span> <span class="n">vo</span><span class="o">=</span><span class="n">vo</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">/=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">/=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">/=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">/=</span> <span class="n">vo</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">/=</span> <span class="n">vo</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">/=</span> <span class="n">vo</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xc</span> <span class="o">/=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">yc</span> <span class="o">/=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zc</span> <span class="o">/=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vxc</span> <span class="o">/=</span> <span class="n">vo</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vyc</span> <span class="o">/=</span> <span class="n">vo</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vzc</span> <span class="o">/=</span> <span class="n">vo</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">xgc</span> <span class="o">/=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span> <span class="o">/=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zgc</span> <span class="o">/=</span> <span class="n">ro</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vxgc</span> <span class="o">/=</span> <span class="n">vo</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vygc</span> <span class="o">/=</span> <span class="n">vo</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vzgc</span> <span class="o">/=</span> <span class="n">vo</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;galpy&quot;</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">rv3d</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">do_key_params</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">key_params</span><span class="p">()</span></div>

<div class="viewcode-block" id="to_units"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.to_units">[docs]</a><span class="k">def</span> <span class="nf">to_units</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ro</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">vo</span><span class="o">=</span><span class="mf">220.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       to_units</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Convert stellar positions/velocities, centre of mass, and orbital position and velocity to user defined units</span>

<span class="sd">    INPUT:</span>

<span class="sd">       units - &#39;nbody&#39;,&#39;pckms&#39;,&#39;kpckms&#39;,&#39;galpy&#39;</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">        None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;nbody&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_nbody</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="n">do_key_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;galpy&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_galpy</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="n">do_key_params</span><span class="p">,</span> <span class="n">ro</span><span class="o">=</span><span class="n">ro</span><span class="p">,</span> <span class="n">vo</span><span class="o">=</span><span class="n">vo</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;pckms&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_pckms</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="n">do_key_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;kpckms&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_kpckms</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="n">do_key_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;radec&quot;</span><span class="p">:</span>
        <span class="n">origin0</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_radec</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="n">do_key_params</span><span class="p">)</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_origin</span><span class="p">(</span><span class="n">origin0</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="n">do_key_params</span><span class="p">)</span></div>

<div class="viewcode-block" id="rotate_to_tail"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.rotate_to_tail">[docs]</a><span class="k">def</span> <span class="nf">rotate_to_tail</span><span class="p">(</span><span class="n">cluster</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       rotate_to_tail</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Rotate the coordinate system to be aligned with cluster&#39;s orbit (Work in progress)</span>

<span class="sd">    INPUT:</span>

<span class="sd">       cluster - StarCluster instance</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">!=</span> <span class="s2">&quot;cluster&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_cluster</span><span class="p">()</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cluster</span><span class="o">.</span><span class="n">vxgc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vygc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vzgc</span><span class="p">])</span>
    <span class="n">thetax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">thetay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="n">thetaz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">thetax</span><span class="p">,</span> <span class="n">thetay</span><span class="p">,</span> <span class="n">thetaz</span><span class="p">)</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span></div>

<div class="viewcode-block" id="to_centre"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.to_centre">[docs]</a><span class="k">def</span> <span class="nf">to_centre</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centre_method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       to_centre</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Shift coordinates such that origin is the centre of mass</span>

<span class="sd">    INPUT:</span>

<span class="sd">       None</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">!=</span> <span class="s2">&quot;centre&quot;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">!=</span> <span class="s2">&quot;cluster&quot;</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_cluster</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centre_method</span><span class="o">=</span><span class="n">centre_method</span><span class="p">)</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">xc</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">yc</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">zc</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vxc</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vyc</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vzc</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;centre&quot;</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">rv3d</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">do_key_params</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">key_params</span><span class="p">(</span><span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">)</span></div>

<div class="viewcode-block" id="to_cluster"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.to_cluster">[docs]</a><span class="k">def</span> <span class="nf">to_cluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">centre_method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       to_cluster</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Shift coordinates to clustercentric reference frame</span>

<span class="sd">    INPUT:</span>

<span class="sd">       do_order - re-sort cluster radii (default: False)</span>

<span class="sd">       do_key_params - call key_params after shift (default: False)</span>

<span class="sd">       centre_method - method for shifting to clustercentric coordinates when units=&#39;radec&#39; and origin=&#39;sky&#39;.</span>

<span class="sd">    NOTES:</span>

<span class="sd">       When units=&#39;radec&#39; and origin=&#39;sky&#39;, the cluster will be shifted to clustercentric coordinates using:</span>
<span class="sd">            centre_method=None: angular distance between each star&#39;s RA/DEC and the RA/DEC of the </span>
<span class="sd">            cluster&#39;s centre with proper motions directly subtracted off</span>
<span class="sd">            centre_method=&#39;orthographic&#39; , positions and velocities changed to orthnormal coordinates (Helmi et al. 2018)</span>
<span class="sd">            centre_method=&#39;VandeVen&#39; , positions and velocities changed to clustercentric coordinates using method</span>
<span class="sd">            outlined by Van de Ven et al. 2005</span>

<span class="sd">        Note the the line of site positions and velocities will just have the galactocentric coordinates of the cluster</span>
<span class="sd">        subtracted off. Be sure to set projected=True when making any calculations to use only x and y coordinates</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">        None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">centre_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">centre_method</span> <span class="o">=</span> <span class="n">centre_method</span>

    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">!=</span> <span class="s2">&quot;cluster&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;radec&quot;</span> <span class="ow">and</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;sky&quot;</span><span class="p">:</span>
            <span class="n">ra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">pmra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="mf">3600.0</span><span class="p">))</span>
            <span class="n">pmdec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1000.0</span> <span class="o">*</span> <span class="mf">3600.0</span><span class="p">))</span>
            <span class="n">ra_gc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">xgc</span><span class="p">)</span>
            <span class="n">dec_gc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">centre_method</span> <span class="o">==</span> <span class="s2">&quot;orthographic&quot;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span> <span class="o">-</span> <span class="n">ra_gc</span><span class="p">)</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec_gc</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                    <span class="n">dec_gc</span>
                <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span> <span class="o">-</span> <span class="n">ra_gc</span><span class="p">)</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>

                <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">=</span> <span class="n">pmra</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span> <span class="o">-</span> <span class="n">ra_gc</span><span class="p">)</span> <span class="o">-</span> <span class="n">pmdec</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                    <span class="n">ra</span> <span class="o">-</span> <span class="n">ra_gc</span>
                <span class="p">)</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">=</span> <span class="n">pmra</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec_gc</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                    <span class="n">ra</span> <span class="o">-</span> <span class="n">ra_gc</span>
                <span class="p">)</span> <span class="o">+</span> <span class="n">cluster</span><span class="o">.</span><span class="n">pmdec</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec_gc</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec_gc</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span> <span class="o">-</span> <span class="n">ra_gc</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">zgc</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">centre_method</span> <span class="o">==</span> <span class="s2">&quot;VandeVen&quot;</span><span class="p">:</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="mf">10800.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ra</span> <span class="o">-</span> <span class="n">ra_gc</span><span class="p">)</span> <span class="o">/</span> <span class="mf">60.0</span>
                    <span class="p">)</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="mf">10800.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                        <span class="o">*</span> <span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec_gc</span><span class="p">)</span>
                            <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dec_gc</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ra</span> <span class="o">-</span> <span class="n">ra_gc</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="o">/</span> <span class="mf">60.0</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">cluster</span><span class="o">.</span><span class="n">xgc</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span><span class="p">))</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span>

                <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">zgc</span>

                <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">-=</span> <span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">vxgc</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vygc</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vzgc</span>

        <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;centre&quot;</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">xc</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">yc</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">zc</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">+=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vxc</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">+=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vyc</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">+=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vzc</span>
        <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;galaxy&quot;</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">xgc</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">zgc</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vxgc</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vygc</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">-=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vzgc</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">rv3d</span><span class="p">()</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;cluster&quot;</span>
        <span class="k">if</span> <span class="n">do_key_params</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">key_params</span><span class="p">(</span><span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">)</span></div>

<div class="viewcode-block" id="to_galaxy"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.to_galaxy">[docs]</a><span class="k">def</span> <span class="nf">to_galaxy</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       to_galaxy</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Shift coordinates to galactocentric reference frame</span>

<span class="sd">    INPUT:</span>

<span class="sd">       None</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s2">&quot;radec&quot;</span> <span class="ow">and</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;sky&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">from_radec</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">!=</span> <span class="s2">&quot;galaxy&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;centre&quot;</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">to_cluster</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">xgc</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">ygc</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">+=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">zgc</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">+=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vxgc</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">+=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vygc</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">+=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vzgc</span>

        <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;galaxy&quot;</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">rv3d</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">do_key_params</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">key_params</span><span class="p">(</span><span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">)</span></div>

<div class="viewcode-block" id="to_sky"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.to_sky">[docs]</a><span class="k">def</span> <span class="nf">to_sky</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       to_sky</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Calculate on-sky position, proper motion, and radial velocity of cluster</span>
<span class="sd">        --&gt; Also changes units to radec</span>
<span class="sd">    INPUT:</span>

<span class="sd">       None</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">        None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2019 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">to_radec</span><span class="p">(</span><span class="n">do_key_params</span><span class="o">=</span><span class="n">do_key_params</span><span class="p">)</span></div>

<span class="k">def</span> <span class="nf">from_sky</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       from_sky</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Calculate galactocentric coordinates from on-sky position, proper motion, and radial velocity of cluster</span>
<span class="sd">        -&gt; Also changes units to kpckms</span>
<span class="sd">    INPUT:</span>

<span class="sd">       None</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">        None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2019 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">from_radec</span><span class="p">(</span><span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="n">do_key_params</span><span class="p">)</span>

<div class="viewcode-block" id="to_tail"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.to_tail">[docs]</a><span class="k">def</span> <span class="nf">to_tail</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       to_tail</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Calculate positions and velocities of stars when rotated such that clusters velocity vector</span>
<span class="sd">       points along x-axis</span>

<span class="sd">    INPUT:</span>

<span class="sd">       None</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">        x_rot,y_rot,z_rot,vx_rot,vy_rot,vz_rot</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2019 - Written - Webb (UofT)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">units0</span><span class="p">,</span> <span class="n">origin0</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">to_centre</span><span class="p">()</span>

    <span class="n">v_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cluster</span><span class="o">.</span><span class="n">vxgc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vygc</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vzgc</span><span class="p">])</span>
    <span class="n">new_v_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

    <span class="n">rot</span> <span class="o">=</span> <span class="n">_rotate_to_arbitrary_vector</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">v_vec</span><span class="p">),</span> <span class="n">new_v_vec</span><span class="p">,</span> <span class="n">inv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">_dontcutsmall</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="n">x_tail</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">y_tail</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">z_tail</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">cluster</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">vx_tail</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">vy_tail</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">vz_tail</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">*</span> <span class="n">rot</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">to_origin</span><span class="p">(</span><span class="n">origin0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x_tail</span><span class="p">,</span><span class="n">y_tail</span><span class="p">,</span><span class="n">z_tail</span><span class="p">,</span><span class="n">vx_tail</span><span class="p">,</span><span class="n">vy_tail</span><span class="p">,</span><span class="n">vz_tail</span></div>

<div class="viewcode-block" id="to_origin"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.to_origin">[docs]</a><span class="k">def</span> <span class="nf">to_origin</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       to_origin</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Shift cluster to origin as defined by keyword</span>

<span class="sd">    INPUT:</span>

<span class="sd">       origin - accepts &#39;cluster&#39;,&#39;centre&#39;,&#39;galaxy&#39;</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">        None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2019 - Written - Webb (UofT)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;centre&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_centre</span><span class="p">(</span><span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="n">do_key_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;cluster&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_cluster</span><span class="p">(</span><span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="n">do_key_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;galaxy&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_galaxy</span><span class="p">(</span><span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="n">do_key_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">origin</span> <span class="o">==</span> <span class="s2">&quot;sky&quot;</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_sky</span><span class="p">(</span><span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="n">do_key_params</span><span class="p">)</span></div>


<div class="viewcode-block" id="save_cluster"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.save_cluster">[docs]</a><span class="k">def</span> <span class="nf">save_cluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       save_cluster</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Save cluster&#39;s units and origin</span>

<span class="sd">    INPUT:</span>

<span class="sd">       cluster - StarCluster instance</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       units, origin</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span></div>


<div class="viewcode-block" id="return_cluster"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.return_cluster">[docs]</a><span class="k">def</span> <span class="nf">return_cluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">units0</span><span class="p">,</span> <span class="n">origin0</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       return_cluster</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       return cluster to a specific combination of units and origin</span>

<span class="sd">    INPUT:</span>

<span class="sd">       cluster - StarCluster instance</span>

<span class="sd">       units0 - units that StarCluster will be changed to</span>

<span class="sd">       origin0 - origin that StarCluster will be changed to</span>


<span class="sd">    OUTPUT:</span>

<span class="sd">       None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">units</span> <span class="o">!=</span> <span class="n">units0</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_units</span><span class="p">(</span><span class="n">units0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">origin</span> <span class="o">!=</span> <span class="n">origin0</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">to_origin</span><span class="p">(</span><span class="n">origin0</span><span class="p">,</span> <span class="n">do_order</span><span class="o">=</span><span class="n">do_order</span><span class="p">,</span> <span class="n">do_key_params</span><span class="o">=</span><span class="n">do_key_params</span><span class="p">)</span></div>

<div class="viewcode-block" id="reset_nbody_scale"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.reset_nbody_scale">[docs]</a><span class="k">def</span> <span class="nf">reset_nbody_scale</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">mass</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">radii</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rvirial</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       reset_nbody_scale</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Assign new conversions for real mass, size, and velocity to Nbody units</span>

<span class="sd">    INPUT:</span>

<span class="sd">       cluster - StarCluster instance</span>

<span class="sd">       mass - find new mass conversion (Default: True)</span>

<span class="sd">       radii - find new radius conversion (Default: True)</span>

<span class="sd">       rvirial - use virial radius to set conversion rate for radii as opposed to the approximation that rbar=4/3 rm</span>

<span class="sd">    KWARGS:</span>

<span class="sd">       same as rvirial</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">units0</span><span class="p">,</span> <span class="n">origin0</span> <span class="o">=</span> <span class="n">save_cluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">to_centre</span><span class="p">()</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">to_pckms</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">mass</span><span class="p">:</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">zmbar</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">mtot</span>

    <span class="k">if</span> <span class="n">radii</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rvirial</span><span class="p">:</span>

            <span class="n">H</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="mf">70.0</span><span class="p">)</span>
            <span class="n">Om</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Om&quot;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
            <span class="n">overdens</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;overdens&quot;</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">)</span>
            <span class="n">nrad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nrad&quot;</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
            <span class="n">projected</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projected&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="n">cluster</span><span class="o">.</span><span class="n">rvirial</span><span class="p">(</span>
                <span class="n">H</span><span class="o">=</span><span class="n">H</span><span class="p">,</span> <span class="n">Om</span><span class="o">=</span><span class="n">Om</span><span class="p">,</span> <span class="n">overdens</span><span class="o">=</span><span class="n">overdens</span><span class="p">,</span> <span class="n">nrad</span><span class="o">=</span><span class="n">nrad</span><span class="p">,</span> <span class="n">projected</span><span class="o">=</span><span class="n">projected</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rm</span> <span class="o">/</span> <span class="mf">3.0</span>

    <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span> <span class="o">=</span> <span class="mf">0.06557</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">zmbar</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span><span class="p">)</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">tstar</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span> <span class="o">/</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vstar</span>

    <span class="n">return_cluster</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">units0</span><span class="p">,</span> <span class="n">origin0</span><span class="p">)</span></div>

<div class="viewcode-block" id="convert_binary_units"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.convert_binary_units">[docs]</a><span class="k">def</span> <span class="nf">convert_binary_units</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span><span class="n">param</span><span class="p">,</span><span class="n">from_units</span><span class="p">,</span><span class="n">to_units</span><span class="p">):</span>
    <span class="n">yrs</span> <span class="o">=</span> <span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span> <span class="o">*</span> <span class="mf">1296000.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">**</span> <span class="mf">1.5</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">zmbar</span><span class="p">)</span>
    <span class="n">days</span> <span class="o">=</span> <span class="mf">365.25</span> <span class="o">*</span> <span class="n">yrs</span>
    <span class="n">au</span> <span class="o">=</span> <span class="mf">1.49597870700e13</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="mf">1296000.0e0</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">au</span>
    <span class="n">rsun</span><span class="o">=</span><span class="mf">6.960e10</span>
    <span class="n">su</span><span class="o">=</span><span class="n">pc</span><span class="o">/</span><span class="n">rsun</span><span class="o">*</span><span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>


    <span class="n">param</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">from_units</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">from_units</span><span class="p">)</span>
    <span class="n">tp_units</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">to_units</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">)):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">p</span><span class="o">==</span><span class="s1">&#39;pb&#39;</span><span class="p">:</span>
            <span class="c1">#Convert to nbody first</span>
            <span class="k">if</span> <span class="n">from_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;days&#39;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">pb</span><span class="o">/=</span><span class="n">days</span>
            <span class="k">elif</span> <span class="n">from_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;years&#39;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">pb</span><span class="o">/=</span><span class="n">yrs</span>
            <span class="k">elif</span> <span class="n">from_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;nbody&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;UNIT </span><span class="si">%s</span><span class="s1"> NOT FOUND&#39;</span> <span class="o">%</span> <span class="n">from_units</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">to_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;days&#39;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">pb</span><span class="o">*=</span><span class="n">days</span>
            <span class="k">elif</span> <span class="n">to_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;years&#39;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">pb</span><span class="o">*=</span><span class="n">yrs</span>
            <span class="k">elif</span> <span class="n">to_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;nbody&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;UNIT </span><span class="si">%s</span><span class="s1"> NOT FOUND&#39;</span> <span class="o">%</span> <span class="n">from_units</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">p</span><span class="o">==</span><span class="s1">&#39;semi&#39;</span><span class="p">:</span>
            <span class="c1">#Convert to nbody first</span>
            <span class="k">if</span> <span class="n">from_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;pc&#39;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">semi</span><span class="o">/=</span><span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
            <span class="k">elif</span> <span class="n">from_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;su&#39;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">semi</span><span class="o">/=</span><span class="n">su</span>
            <span class="k">elif</span> <span class="n">from_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;au&#39;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">semi</span><span class="o">/=</span><span class="p">(</span><span class="n">pc</span><span class="o">/</span><span class="n">au</span><span class="p">)</span><span class="o">*</span><span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
            <span class="k">elif</span> <span class="n">from_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;nbody&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;UNIT </span><span class="si">%s</span><span class="s1"> NOT FOUND&#39;</span> <span class="o">%</span> <span class="n">from_units</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">to_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;pc&#39;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">semi</span><span class="o">*=</span><span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
            <span class="k">elif</span> <span class="n">to_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;su&#39;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">semi</span><span class="o">*=</span><span class="n">su</span>
            <span class="k">elif</span> <span class="n">to_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;au&#39;</span><span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">semi</span><span class="o">*=</span><span class="p">(</span><span class="n">pc</span><span class="o">/</span><span class="n">au</span><span class="p">)</span><span class="o">*</span><span class="n">cluster</span><span class="o">.</span><span class="n">rbar</span>
            <span class="k">elif</span> <span class="n">to_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;nbody&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;UNIT </span><span class="si">%s</span><span class="s1"> NOT FOUND&#39;</span> <span class="o">%</span> <span class="n">to_units</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">p</span><span class="o">==</span><span class="s1">&#39;mass&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">from_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Msun&#39;</span> <span class="ow">or</span> <span class="n">from_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;msun&#39;</span> <span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">m1</span><span class="o">/=</span><span class="n">cluster</span><span class="o">.</span><span class="n">zmbar</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">m2</span><span class="o">/=</span><span class="n">cluster</span><span class="o">.</span><span class="n">zmbar</span>
            <span class="k">elif</span> <span class="n">from_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;nbody&#39;</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="n">to_units</span><span class="o">==</span><span class="s1">&#39;Msun&#39;</span> <span class="ow">or</span> <span class="n">to_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;msun&#39;</span> <span class="p">:</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">m1</span><span class="o">*=</span><span class="n">cluster</span><span class="o">.</span><span class="n">zmbar</span>
                <span class="n">cluster</span><span class="o">.</span><span class="n">m2</span><span class="o">*=</span><span class="n">cluster</span><span class="o">.</span><span class="n">zmbar</span>
            <span class="k">elif</span> <span class="n">to_units</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;nbody&#39;</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="add_rotation"><a class="viewcode-back" href="../../../reference/clustertools.analysis.operations.html#clustertools.analysis.operations.add_rotation">[docs]</a><span class="k">def</span> <span class="nf">add_rotation</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="n">qrot</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NAME:</span>

<span class="sd">       add_rotation</span>

<span class="sd">    PURPOSE:</span>

<span class="sd">       Add a degree of rotation to an already generated StarCluster</span>

<span class="sd">    INPUT:</span>

<span class="sd">       cluster - StarCluster instance</span>

<span class="sd">       qrot - the fraction of stars with v_phi &lt; 0 that are switched to vphi &gt; 0</span>

<span class="sd">    OUTPUT:</span>

<span class="sd">       None</span>

<span class="sd">    HISTORY:</span>

<span class="sd">       2018 - Written - Webb (UofT)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">rect_to_cyl</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
    <span class="n">vr</span><span class="p">,</span> <span class="n">vtheta</span><span class="p">,</span> <span class="n">vz</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">rect_to_cyl_vec</span><span class="p">(</span>
        <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">z</span>
    <span class="p">)</span>

    <span class="n">indx</span> <span class="o">=</span> <span class="n">vtheta</span> <span class="o">&lt;</span> <span class="mf">0.0</span>
    <span class="n">rindx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">ntot</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">qrot</span>

    <span class="n">vtheta</span><span class="p">[</span><span class="n">indx</span> <span class="o">*</span> <span class="n">rindx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vtheta</span><span class="p">[</span><span class="n">indx</span> <span class="o">*</span> <span class="n">rindx</span><span class="p">]</span> <span class="o">*</span> <span class="n">vtheta</span><span class="p">[</span><span class="n">indx</span> <span class="o">*</span> <span class="n">rindx</span><span class="p">])</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">cyl_to_rect</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
    <span class="n">cluster</span><span class="o">.</span><span class="n">vx</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vy</span><span class="p">,</span> <span class="n">cluster</span><span class="o">.</span><span class="n">vz</span> <span class="o">=</span> <span class="n">bovy_coords</span><span class="o">.</span><span class="n">cyl_to_rect_vec</span><span class="p">(</span>
        <span class="n">vr</span><span class="p">,</span> <span class="n">vtheta</span><span class="p">,</span> <span class="n">vz</span><span class="p">,</span> <span class="n">theta</span>
    <span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">clustertools 0.1.dev1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Jeremy J. Webb.
      Last updated on 22 Jun 2020.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>